<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Raio-X Score 5 - An√°lise inteligente de performance de estabelecimentos comerciais"
    />
    <meta name="theme-color" content="#00a8ff" />
    <title>
      Raio-X Score 5 | Sistema de intelig√™ncia de dados - ü§ñ Powered by DIRETA
      MG
    </title>
    <!-- Favicon do rob√¥ -->
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%2300a8ff;stop-opacity:1' /><stop offset='100%' style='stop-color:%230077b6;stop-opacity:1' /></linearGradient></defs><rect width='100' height='100' rx='20' fill='url(%23grad)'/><circle cx='50' cy='35' r='8' fill='white'/><circle cx='35' cy='30' r='3' fill='white'/><circle cx='65' cy='30' r='3' fill='white'/><rect x='30' y='50' width='40' height='25' rx='5' fill='white'/><circle cx='40' cy='62' r='2' fill='%2300a8ff'/><circle cx='50' cy='62' r='2' fill='%2300a8ff'/><circle cx='60' cy='62' r='2' fill='%2300a8ff'/></svg>"
    />
    <link
      rel="apple-touch-icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='grad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%2300a8ff;stop-opacity:1' /><stop offset='100%' style='stop-color:%230077b6;stop-opacity:1' /></linearGradient></defs><rect width='100' height='100' rx='20' fill='url(%23grad)'/><circle cx='50' cy='35' r='8' fill='white'/><circle cx='35' cy='30' r='3' fill='white'/><circle cx='65' cy='30' r='3' fill='white'/><rect x='30' y='50' width='40' height='25' rx='5' fill='white'/><circle cx='40' cy='62' r='2' fill='%2300a8ff'/><circle cx='50' cy='62' r='2' fill='%2300a8ff'/><circle cx='60' cy='62' r='2' fill='%2300a8ff'/></svg>"
    />

    <!-- React e ReactDOM via CDN -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>

    <style>
      /* Reset e configura√ß√µes base */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html,
      body {
        height: 100%;
        font-family: "Inter", "Segoe UI", "Roboto", sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        overflow-x: hidden;
      }

      /* Design System de Cores Profissional - ATUALIZADO */
      :root {
        --primary-color: #00a8ff;
        --primary-light: #4cd3ff;
        --primary-dark: #0077b6;
        --secondary-color: #8e9aaf;
        --accent-color: #ff9e00;
        --accent-light: #ffb74d;
        --success-color: #00d1b2;
        --warning-color: #ff9e00;
        --error-color: #ff3860;

        /* Tons de cinza profissionais atualizados */
        --gray-50: #f8fafc;
        --gray-100: #f1f5f9;
        --gray-200: #e2e8f0;
        --gray-300: #cbd5e1;
        --gray-400: #94a3b8;
        --gray-500: #64748b;
        --gray-600: #475569;
        --gray-700: #334155;
        --gray-800: #1e293b;
        --gray-900: #0f172a;

        /* Backgrounds atualizados */
        --bg-primary: #ffffff;
        --bg-secondary: rgba(248, 250, 252, 0.9);
        --bg-tertiary: rgba(241, 245, 249, 0.8);
        --bg-card: rgba(255, 255, 255, 0.95);
        --bg-glass: rgba(255, 255, 255, 0.1);

        /* Textos - ATUALIZADO para melhor contraste */
        --text-primary: #1e293b;
        --text-secondary: #475569;
        --text-tertiary: #64748b;
        --text-inverse: #ffffff;

        /* Bordas e sombras atualizadas */
        --border-light: rgba(226, 232, 240, 0.8);
        --border-medium: rgba(203, 213, 225, 0.8);
        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);

        /* Transi√ß√µes */
        --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-spring: 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);

        /* Spacing profissional */
        --space-xs: 0.25rem;
        --space-sm: 0.5rem;
        --space-md: 1rem;
        --space-lg: 1.5rem;
        --space-xl: 2rem;
        --space-2xl: 3rem;
        --space-3xl: 4rem;

        /* Border radius corporativo */
        --radius-sm: 0.375rem;
        --radius-md: 0.5rem;
        --radius-lg: 0.75rem;
        --radius-xl: 1rem;
        --radius-2xl: 1.5rem;
      }

      /* Aplica√ß√£o do tema */
      .app {
        min-height: 100vh;
        position: relative;
      }

      /* Video Background */
      .video-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        overflow: hidden;
      }

      .video-background video {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      /* Efeito de Part√≠culas */
      .particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: -1;
      }

      .particle {
        position: absolute;
        background: rgba(0, 168, 255, 0.3);
        border-radius: 50%;
        animation: float 15s infinite linear;
      }

      @keyframes float {
        0% {
          transform: translateY(0) translateX(0);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          transform: translateY(-100vh) translateX(100px);
          opacity: 0;
        }
      }

      /* ============================================
           TELA DE BOAS-VINDAS PROFISSIONAL - ATUALIZADA
           ============================================ */
      .welcome-screen {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        padding: var(--space-xl);
        position: relative;
      }

      .welcome-content {
        text-align: center;
        max-width: 600px;
        z-index: 1;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(25px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 24px;
        padding: 3rem 2rem;
        box-shadow: 0 8px 32px rgba(0, 168, 255, 0.2),
          0 0 0 1px rgba(255, 255, 255, 0.1) inset;
        animation: floatIn 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
      }

      @keyframes floatIn {
        0% {
          opacity: 0;
          transform: translateY(30px) scale(0.95);
        }
        100% {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .welcome-title {
        font-size: 3.5rem;
        font-weight: 800;
        margin-bottom: var(--space-lg);
        background: linear-gradient(
          135deg,
          var(--primary-light),
          var(--primary-color)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: -0.02em;
        line-height: 1.1;
        text-shadow: 0 0 20px rgba(0, 168, 255, 0.5);
      }

      .subtitle-container {
        height: 2.5rem;
        margin-bottom: var(--space-2xl);
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .welcome-subtitle {
        font-size: 1.25rem;
        font-weight: 500;
        color: var(--text-inverse);
        transition: all var(--transition-slow);
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      }

      .robot-container {
        margin: var(--space-2xl) 0;
        display: flex;
        justify-content: center;
      }

      .robot-image {
        width: 140px;
        height: 140px;
        border-radius: var(--radius-2xl);
        background: rgba(255, 255, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: var(--shadow-2xl);
        transition: all var(--transition-normal);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
        animation: bounceGentle 3s ease-in-out infinite;
      }

      .robot-image:hover {
        transform: translateY(-4px) scale(1.05);
        box-shadow: 0 30px 60px rgba(0, 168, 255, 0.3);
      }

      .robot-icon {
        width: 80px;
        height: 80px;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
      }

      .company-info {
        font-size: 1.125rem;
        color: var(--text-inverse);
        margin-bottom: var(--space-2xl);
        font-weight: 500;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      }

      .company-name {
        color: var(--primary-light);
        font-weight: 700;
      }

      .start-button {
        display: inline-flex;
        align-items: center;
        gap: var(--space-sm);
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-dark)
        );
        color: white;
        border: none;
        padding: var(--space-lg) var(--space-2xl);
        font-size: 1.125rem;
        font-weight: 600;
        border-radius: var(--radius-xl);
        cursor: pointer;
        transition: all var(--transition-normal);
        box-shadow: var(--shadow-lg);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        position: relative;
        overflow: hidden;
      }

      .start-button::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s;
      }

      .start-button:hover::before {
        left: 100%;
      }

      .start-button:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-xl);
      }

      .start-button:active {
        transform: translateY(0);
      }

      /* ============================================
           CHAT CONTAINER PROFISSIONAL - ATUALIZADO
           ============================================ */
      .chat-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: var(--space-lg);
      }

      .phone-frame {
        width: 100%;
        max-width: 400px;
        height: 90vh;
        max-height: 700px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 28px;
        border: 1px solid rgba(255, 255, 255, 0.8);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25),
          0 0 0 1px rgba(255, 255, 255, 0.3) inset;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        position: relative;
      }

      @media (min-width: 768px) {
        .phone-frame {
          width: 420px;
          height: 85vh;
        }
      }

      /* Header profissional */
      .chat-header {
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        padding: var(--space-lg);
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: white;
        position: relative;
        box-shadow: var(--shadow-md);
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      }

      .header-info {
        display: flex;
        align-items: center;
        gap: var(--space-md);
      }

      .header-avatar {
        width: 48px;
        height: 48px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: var(--radius-xl);
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all var(--transition-normal);
      }

      .header-title {
        font-size: 1.125rem;
        font-weight: 700;
        margin-bottom: 2px;
        color: white;
      }

      .header-subtitle {
        font-size: 0.75rem;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.8);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .close-button {
        width: 36px;
        height: 36px;
        border: none;
        background: rgba(255, 255, 255, 0.2);
        border-radius: var(--radius-lg);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all var(--transition-normal);
        color: white;
      }

      .close-button:hover {
        background: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
      }

      /* Container de mensagens */
      .messages-container {
        flex: 1;
        overflow-y: auto;
        padding: var(--space-lg);
        background: var(--bg-secondary);
        display: flex;
        flex-direction: column;
        gap: var(--space-md);
        scrollbar-width: thin;
        scrollbar-color: var(--primary-color) transparent;
      }

      .messages-container::-webkit-scrollbar {
        width: 6px;
      }

      .messages-container::-webkit-scrollbar-thumb {
        background: var(--primary-color);
        border-radius: 3px;
        opacity: 0.3;
      }

      /* Mensagens profissionais - CORRIGIDAS PARA MELHOR VISIBILIDADE */
      .message {
        max-width: 85%;
        padding: var(--space-md) var(--space-lg);
        border-radius: var(--radius-xl);
        line-height: 1.6;
        font-size: 0.875rem;
        animation: messageSlide 0.4s ease-out;
        position: relative;
        word-wrap: break-word;
        box-shadow: var(--shadow-sm);
      }

      @keyframes messageSlide {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .message.user {
        align-self: flex-end;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        color: white;
        border-bottom-right-radius: var(--radius-sm);
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(0, 168, 255, 0.3);
      }

      .message.user strong {
        color: white;
      }

      .message.bot {
        align-self: flex-start;
        background: var(--bg-card);
        color: var(--text-primary);
        border: 1px solid var(--border-light);
        border-bottom-left-radius: var(--radius-sm);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .message.bot strong {
        color: var(--primary-color);
        font-weight: 700;
      }

      /* Indicador de digita√ß√£o */
      .typing-indicator {
        display: flex;
        align-items: center;
        gap: var(--space-sm);
        padding: var(--space-md) var(--space-lg);
        background: var(--bg-card);
        color: var(--text-secondary);
        border-radius: var(--radius-xl);
        border: 1px solid var(--border-light);
        font-size: 0.875rem;
        font-weight: 500;
        align-self: flex-start;
        max-width: fit-content;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .typing-dots {
        display: flex;
        gap: 4px;
      }

      .typing-dot {
        width: 6px;
        height: 6px;
        background: var(--primary-color);
        border-radius: 50%;
        animation: typingPulse 1.4s infinite;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }
      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typingPulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.2);
          opacity: 0.7;
        }
      }

      /* Input container profissional */
      .input-container {
        background: var(--bg-card);
        padding: var(--space-lg);
        border-top: 1px solid var(--border-light);
        box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
      }

      .chat-form {
        display: flex;
        gap: var(--space-md);
        align-items: center;
      }

      .message-input {
        flex: 1;
        padding: var(--space-md) var(--space-lg);
        background: var(--bg-tertiary);
        border: 2px solid transparent;
        border-radius: var(--radius-xl);
        color: var(--text-primary);
        font-size: 0.875rem;
        font-weight: 500;
        outline: none;
        transition: all var(--transition-normal);
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
      }

      .message-input:focus {
        border-color: var(--primary-color);
        background: var(--bg-secondary);
        box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05),
          0 0 0 4px rgba(0, 168, 255, 0.1);
      }

      .message-input::placeholder {
        color: var(--text-tertiary);
        font-weight: 400;
      }

      .send-button {
        width: 48px;
        height: 48px;
        background: linear-gradient(
          135deg,
          var(--primary-color),
          var(--primary-light)
        );
        border: none;
        border-radius: var(--radius-xl);
        color: white;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all var(--transition-normal);
        box-shadow: var(--shadow-md);
      }

      .send-button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .send-button:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        background: linear-gradient(135deg, #9ca3af, #6b7280);
      }

      /* ============================================
           RESPONSIVIDADE PROFISSIONAL
           ============================================ */
      @media (max-width: 640px) {
        .welcome-title {
          font-size: 2.5rem;
        }

        .welcome-subtitle {
          font-size: 1.125rem;
        }

        .robot-image {
          width: 120px;
          height: 120px;
        }

        .robot-icon {
          width: 60px;
          height: 60px;
        }

        .chat-container {
          padding: var(--space-sm);
        }

        .phone-frame {
          height: 95vh;
          max-height: none;
          border-radius: 20px;
        }

        .message {
          font-size: 0.8rem;
          max-width: 90%;
        }

        .welcome-content {
          padding: 2rem 1.5rem;
          margin: 1rem;
        }

        .start-button {
          padding: var(--space-md) var(--space-xl);
          font-size: 1rem;
        }
      }

      @media (max-width: 480px) {
        .welcome-title {
          font-size: 2rem;
        }

        .welcome-subtitle {
          font-size: 1rem;
        }

        .company-info {
          font-size: 1rem;
        }

        .phone-frame {
          border-radius: 16px;
        }

        .chat-header {
          padding: var(--space-md);
        }

        .header-avatar {
          width: 40px;
          height: 40px;
        }

        .header-title {
          fontsize: 1rem;
        }

        .header-subtitle {
          fontsize: 0.7rem;
        }
      }

      /* Estados de loading */
      .loading {
        opacity: 0.7;
        pointer-events: none;
      }

      .loading .send-button {
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      /* Anima√ß√µes */
      @keyframes bounceGentle {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-8px);
        }
      }

      .animate-fade-in-up {
        animation: fadeInUp 0.8s ease-out forwards;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(40px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .animate-message-slide {
        animation: messageSlide 0.4s ease-out;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script>
      // CONFIGURA√á√ïES INTEGRADAS - SISTEMA COMPLETAMENTE AUT√îNOMO
      const GOOGLE_SHEET_CSV_URL =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vQZiOyvly3nMqoNnJSj7_is0d-mMGGXmeIpXfYEHL2SqQAfNQ5tU4oOsNQsOhi7TKjcBxy2XoWmt2oe/pub?output=csv";
      const GOOGLE_AI_API_KEY = "AIzaSyBTZiUDC2INIspbdFm6R3dZX1A4ls7olSI";

      // Componente de Part√≠culas
      function createParticles() {
        const particlesContainer = document.createElement("div");
        particlesContainer.className = "particles";

        for (let i = 0; i < 15; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";

          // Tamanho aleat√≥rio entre 2px e 6px
          const size = Math.random() * 4 + 2;
          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;

          // Posi√ß√£o aleat√≥ria
          particle.style.left = `${Math.random() * 100}%`;
          particle.style.top = `${Math.random() * 100}%`;

          // Dura√ß√£o da anima√ß√£o aleat√≥ria
          const duration = Math.random() * 10 + 15;
          particle.style.animationDuration = `${duration}s`;

          // Delay aleat√≥rio
          particle.style.animationDelay = `${Math.random() * 5}s`;

          particlesContainer.appendChild(particle);
        }

        return particlesContainer;
      }

      // Componente React principal
      function App() {
        const [isWelcomeScreen, setIsWelcomeScreen] = React.useState(true);
        const [messages, setMessages] = React.useState([]);
        const [inputValue, setInputValue] = React.useState("");
        const [isLoading, setIsLoading] = React.useState(false);
        const [csvData, setCsvData] = React.useState([]);
        const [isSheetLoaded, setIsSheetLoaded] = React.useState(false);
        const [isTyping, setIsTyping] = React.useState(false);
        const [subtitleIndex, setSubtitleIndex] = React.useState(0);

        // Refs
        const messagesEndRef = React.useRef(null);
        const inputRef = React.useRef(null);

        // Subt√≠tulos animados
        const subtitles = [
          "Sistema de An√°lise de Performance",
          "238 Estabelecimentos Monitorados",
          "IA Conversacional Avan√ßada",
          "Relat√≥rios Estrat√©gicos Autom√°ticos",
        ];

        // Fun√ß√£o para adicionar mensagens
        const addMessage = (content, sender) => {
          const newMessage = {
            content,
            sender,
            timestamp: new Date(),
          };
          setMessages((prev) => [...prev, newMessage]);
        };

        // Fun√ß√£o para scroll autom√°tico
        const scrollToBottom = () => {
          if (messagesEndRef.current) {
            messagesEndRef.current.scrollIntoView({ behavior: "smooth" });
          }
        };

        React.useEffect(() => {
          scrollToBottom();
        }, [messages, isTyping]);

        // Fun√ß√£o para anima√ß√£o do subt√≠tulo
        React.useEffect(() => {
          const interval = setInterval(() => {
            setSubtitleIndex((prev) => (prev + 1) % subtitles.length);
          }, 4000);

          return () => clearInterval(interval);
        }, []);

        // Carregar dados da planilha
        const loadSheetData = async () => {
          if (isSheetLoaded) return;

          try {
            console.log("üìä Carregando planilha Google Sheets...");

            const response = await fetch(GOOGLE_SHEET_CSV_URL, {
              method: "GET",
              mode: "cors",
              headers: {
                Accept: "text/csv, text/plain, text/html, */*",
                "Cache-Control": "no-cache",
              },
            });

            if (!response.ok) {
              throw new Error(
                `HTTP ${response.status} - A planilha n√£o est√° acess√≠vel`
              );
            }

            const text = await response.text();

            // Verificar se √© CSV v√°lido
            if (
              text &&
              text.length > 100 &&
              !text.startsWith("<") &&
              !text.toLowerCase().includes("error")
            ) {
              const lines = text.split("\n").filter((line) => line.trim());
              if (lines.length > 1) {
                const parsedData = parseCSVRobust(text);

                if (parsedData.length > 1) {
                  const processedData = parsedData
                    .slice(1)
                    .map((row) => {
                      const obj = {};
                      const headers = parsedData[0];

                      // Mapear colunas
                      headers.forEach((header, index) => {
                        const key = header.trim().toLowerCase();
                        const value = (row[index] || "").trim();

                        if (
                          key === "eg" ||
                          key === "c√≥digo" ||
                          key === "code"
                        ) {
                          obj.eg = value;
                        } else if (
                          key === "nome fantasia" ||
                          key === "nome" ||
                          key === "estabelecimento"
                        ) {
                          obj.nome_fantasia = value;
                        } else if (key === "rede") {
                          obj.rede = value;
                        } else if (key === "coordenador") {
                          obj.coordenador = value;
                        } else if (
                          key === "supervisor terceiro" ||
                          key === "supervisor"
                        ) {
                          obj.supervisor_terceiro = value;
                        } else if (key === "gn") {
                          obj.gn = value;
                        } else if (key === "sl/sc" || key === "sl/sc") {
                          obj.sl_sc = value;
                        } else if (key === "ae") {
                          obj.ae = value;
                        } else if (
                          key === "m-1" ||
                          key === "m-1" ||
                          key === "m1"
                        ) {
                          obj.m1 = value;
                        } else if (key === "m0") {
                          obj.m0 = value;
                        } else if (
                          key === "vs m-1" ||
                          key === "vs m-1" ||
                          key === "vs m1"
                        ) {
                          obj.vs_m1 = value;
                        } else if (key === "g√¥ndola" || key === "gondola") {
                          obj.gondola = value;
                        } else if (key === "ponto extra") {
                          obj.ponto_extra = value;
                        } else if (key === "base foco" || key === "base_foco") {
                          obj.base_foco = value;
                        } else if (key === "corona") {
                          obj.corona = value;
                        } else if (key === "spaten") {
                          obj.spaten = value;
                        } else if (key === "stella") {
                          obj.stella = value;
                        } else if (key === "cob hdw" || key === "cob_hdw") {
                          obj.cob_hdw = value;
                        } else if (key === "atendimento") {
                          obj.atendimento = value;
                        } else if (
                          key === "visita quinzenal" ||
                          key === "visita_quinzenal"
                        ) {
                          obj.visita_quinzenal = value;
                        } else if (key === "loja") {
                          obj.loja = value;
                        }
                      });

                      return obj;
                    })
                    .filter((item) => item.eg && item.eg.trim() !== "");

                  console.log(
                    `‚úÖ Planilha carregada com ${processedData.length} estabelecimentos`
                  );
                  setCsvData(processedData);
                  setIsSheetLoaded(true);

                  // Notificar sucesso
                  if (processedData.length > 0) {
                    addMessage(
                      `<strong>‚úÖ Sistema Raio-X Score 5 Ativo!</strong><br><br>
üéØ <strong>Sistema 100% Operacional!</strong><br>
238 estabelecimentos carregados com sucesso.<br><br>
Digite o c√≥digo EG de qualquer estabelecimento para an√°lise completa.`,
                      "bot"
                    );
                  }
                  return;
                }
              }
            }

            throw new Error("Resposta n√£o √© um CSV v√°lido");
          } catch (error) {
            console.error("‚ùå Erro ao carregar planilha:", error.message);
            setCsvData([]);
            setIsSheetLoaded(true);

            // Notificar erro
            addMessage(
              `<strong>‚ùå Erro no Sistema</strong><br><br>
Tente novamente em alguns instantes ou entre em contato com o suporte.`,
              "bot"
            );
          }
        };

        // Fun√ß√£o parseCSV robusta
        const parseCSVRobust = (text) => {
          const lines = [];
          const rawLines = text
            .trim()
            .split("\n")
            .filter((line) => line.trim());

          for (const line of rawLines) {
            const row = [];
            let cell = "";
            let inQuote = false;
            const cleanLine = line.replace(/\r$/, "");

            for (let i = 0; i < cleanLine.length; i++) {
              const char = cleanLine[i];
              if (char === '"') {
                if (inQuote && cleanLine[i + 1] === '"') {
                  cell += '"';
                  i++;
                } else {
                  inQuote = !inQuote;
                }
              } else if (char === "," && !inQuote) {
                row.push(cell.trim());
                cell = "";
              } else {
                cell += char;
              }
            }
            row.push(cell.trim());
            lines.push(row);
          }

          return lines;
        };

        // Buscar estabelecimento
        const findEstabelecimento = (code) => {
          if (!code || !csvData.length) return null;

          const normalizedCode = code.trim().toUpperCase();

          // Busca exata
          let found = csvData.find((estabelecimento) => {
            const estabelecimentoCode = (estabelecimento.eg || "")
              .toUpperCase()
              .trim();
            return estabelecimentoCode === normalizedCode;
          });

          // Se n√£o encontrou, busca parcial
          if (!found) {
            found = csvData.find((estabelecimento) => {
              const estabelecimentoCode = (estabelecimento.eg || "")
                .toUpperCase()
                .trim();
              return (
                estabelecimentoCode.includes(normalizedCode) ||
                normalizedCode.includes(estabelecimentoCode)
              );
            });
          }

          return found;
        };

        // An√°lise inteligente
        const getIntelligentAnalysis = (data, code) => {
          const nome = data.nome_fantasia || "N√£o informado";
          const rede = data.rede || "N√£o informado";
          const ae = data.ae || "";
          const m1 = data.m1 || "";
          const m0 = data.m0 || "";
          const vs_m1 = data.vs_m1 || "";
          const gondola = data.gondola || "";
          const pontoExtra = data.ponto_extra || "";
          const coordenador = data.coordenador || "N√£o informado";
          const sl_sc = data.sl_sc || "";
          const gn = data.gn || "";
          const base_foco = data.base_foco || "";
          const corona = data.corona || "";
          const spaten = data.spaten || "";
          const stella = data.stella || "";
          const cob_hdw = data.cob_hdw || "";
          const atendimento = data.atendimento || "";
          const visita_quinzenal = data.visita_quinzenal || "";

          // Converter valores num√©ricos
          const parsePercentage = (val) => {
            if (!val || val === "") return 0;
            const clean = val.replace("%", "").replace(",", ".");
            return parseFloat(clean) || 0;
          };

          const m0Value = parsePercentage(m0);
          const vs_m1Value = parsePercentage(vs_m1);
          const gondolaValue = parsePercentage(gondola);
          const pontoExtraValue = parsePercentage(pontoExtra);

          let positives = [];
          let negatives = [];
          let recommendations = [];

          // An√°lise POSITIVA
          if (vs_m1 && vs_m1Value > 0) {
            positives.push(
              `üìà **Crescimento de ${vs_m1}** no per√≠odo M0 vs M-1`
            );
          }

          if (m0 && m0Value > 60) {
            positives.push(`üöÄ **Performance M0 excelente** com ${m0}`);
          } else if (m0 && m0Value > 45) {
            positives.push(`‚úÖ **Performance M0 satisfat√≥ria** com ${m0}`);
          }

          if (ae === "SIM") {
            positives.push(
              `‚≠ê **Atendimento Especial ativo** - Destaque no atendimento`
            );
          }

          if (gondola && gondolaValue > 50) {
            positives.push(`üéØ **G√¥ndola excelente** com ${gondola}`);
          } else if (gondola && gondolaValue > 35) {
            positives.push(`üëç **G√¥ndola boa** com ${gondola}`);
          }

          if (pontoExtra && pontoExtraValue > 50) {
            positives.push(`üí° **Ponto Extra eficaz** com ${pontoExtra}`);
          }

          if (corona === "OK")
            positives.push(`‚úÖ **Corona implementada** corretamente`);
          if (spaten === "OK")
            positives.push(`‚úÖ **Spaten implementada** corretamente`);
          if (stella === "OK")
            positives.push(`‚úÖ **Stella implementada** corretamente`);
          if (cob_hdw === "OK")
            positives.push(`‚úÖ **COB HDW implementado** corretamente`);

          if (visita_quinzenal === "OK") {
            positives.push(`üìÖ **Visitas quinzenais regulares** mantidas`);
          }

          // An√°lise NEGATIVA
          if (vs_m1 && vs_m1Value < 0) {
            negatives.push(
              `‚ö†Ô∏è **Queda de ${Math.abs(vs_m1Value).toFixed(
                1
              )}%** no per√≠odo vs M-1`
            );
          }

          if (m0 && m0Value < 45) {
            negatives.push(
              `üîª **Performance M0 baixa** - apenas ${m0} (meta: 50%+)`
            );
          }

          if (ae === "N√ÉO") {
            negatives.push(
              `üìâ **Atendimento Especial inativo** - oportunidade de melhoria`
            );
          }

          if (gondola && gondolaValue < 30) {
            negatives.push(
              `‚ùå **G√¥ndola insuficiente** - apenas ${gondola} (meta: 50%+)`
            );
          }

          if (pontoExtra && pontoExtraValue < 30) {
            negatives.push(
              `üö´ **Ponto Extra limitado** - apenas ${pontoExtra} (meta: 50%+)`
            );
          }

          if (corona === "NOK")
            negatives.push(`‚ùå **Corona n√£o implementada**`);
          if (spaten === "NOK")
            negatives.push(`‚ùå **Spaten n√£o implementada**`);
          if (stella === "NOK")
            negatives.push(`‚ùå **Stella n√£o implementada**`);
          if (cob_hdw === "NOK")
            negatives.push(`‚ùå **COB HDW n√£o implementado**`);

          if (atendimento === "N√ÉO")
            negatives.push(`üìã **Atendimento em melhoria necess√°ria**`);

          // Recomenda√ß√µes
          if (vs_m1Value < 0) {
            recommendations.push(
              `üìã **Plano de Recupera√ß√£o**: Implementar estrat√©gias para reverter a tend√™ncia negativa`
            );
          }

          if (m0Value < 50) {
            recommendations.push(
              `üéØ **Meta Performance**: Foco em atingir 50%+ pontos M0`
            );
          }

          if (gondolaValue < 50) {
            recommendations.push(
              `üè™ **Otimiza√ß√£o G√¥ndola**: Revisar distribui√ß√£o e produtos, meta 50%+`
            );
          }

          if (ae === "N√ÉO") {
            recommendations.push(
              `ü§ù **Programa Especial**: Ativar Atendimento Especial AE`
            );
          }

          if (corona === "NOK" || spaten === "NOK" || stella === "NOK") {
            recommendations.push(
              `üç∫ **Implementa√ß√£o Premium**: Resolver pend√™ncias Corona/Spaten/Stella`
            );
          }

          recommendations.push(
            `üìû **Acompanhamento**: Contatar coordenador ${coordenador} para planejamento`
          );

          // Construir resposta
          let response = `<strong>üè¢ AN√ÅLISE COMPLETA - ${code}</strong><br><br>`;
          response += `<strong>üìä ESTABELECIMENTO:</strong><br>`;
          response += `‚Ä¢ <strong>Nome:</strong> ${nome}<br>`;
          response += `‚Ä¢ <strong>Rede:</strong> ${rede}<br>`;
          response += `‚Ä¢ <strong>Coordenador:</strong> ${coordenador}<br>`;
          response += `‚Ä¢ <strong>SL/SC:</strong> ${sl_sc}<br>`;
          response += `‚Ä¢ <strong>AE:</strong> ${ae}<br>`;
          response += `‚Ä¢ <strong>M-1:</strong> ${m1} | <strong>M0:</strong> ${m0} | <strong>vs M-1:</strong> ${vs_m1}<br>`;
          response += `‚Ä¢ <strong>G√¥ndola:</strong> ${gondola} | <strong>GN:</strong> ${gn} | <strong>Ponto Extra:</strong> ${pontoExtra}<br><br>`;

          response += `<strong>‚úÖ PONTOS FORTES (Positivos):</strong><br>`;
          if (positives.length > 0) {
            positives.forEach((pos) => {
              response += `${pos}<br>`;
            });
          } else {
            response += `üìã Estabelecimento com base s√≥lida, buscar incremento nos indicadores<br>`;
          }
          response += `<br>`;

          response += `<strong>‚ö†Ô∏è OPORTUNIDADES (Pontos de Melhoria):</strong><br>`;
          if (negatives.length > 0) {
            negatives.forEach((neg) => {
              response += `${neg}<br>`;
            });
          } else {
            response += `üéâ Excelente performance! Todos os indicadores acima da m√©dia<br>`;
          }
          response += `<br>`;

          response += `<strong>üí° RECOMENDA√á√ïES ESTRAT√âGICAS:</strong><br>`;
          recommendations.forEach((rec) => {
            response += `${rec}<br>`;
          });
          response += `<br>`;

          response += `<strong>üéØ PR√ìXIMOS PASSOS:</strong><br>`;
          response += `‚Ä¢ ${
            vs_m1Value >= 0 ? "‚úÖ Manter" : "üîÑ Revisar"
          } estrat√©gia atual<br>`;
          response += `‚Ä¢ ${
            gondolaValue >= 50 ? "‚úÖ Expandir" : "üìà Desenvolver"
          } pol√≠ticas de g√¥ndola<br>`;
          response += `‚Ä¢ üìä Monitorar evolu√ß√£o mensal dos indicadores<br>`;
          response += `‚Ä¢ ü§ù Agendar visita t√©cnica com supervisor<br>`;
          response += `‚Ä¢ üç∫ Verificar implementa√ß√£o Corona/Spaten/Stella<br><br>`;

          response += `<em>ü§ñ An√°lise DIRETA MG - Sistema Inteligente Raio-X Score 5</em>`;

          return response;
        };

        // Simular typing
        const simulateTyping = (callback, delay = 2000) => {
          setIsTyping(true);
          setTimeout(() => {
            setIsTyping(false);
            callback();
          }, delay);
        };

        // Processar mensagem
        const processMessage = async (message) => {
          const messageLower = message.toLowerCase().trim();

          // Verificar se √© um c√≥digo EG
          const egPattern = /\d{2,6}-\d/;

          if (egPattern.test(message)) {
            simulateTyping(() => {
              searchEstabelecimento(message);
            }, 2500);
            return;
          }

          // Comandos
          if (messageLower === "/ajuda" || messageLower === "ajuda") {
            simulateTyping(() => {
              addMessage(
                `<strong>üí° Comandos Dispon√≠veis:</strong><br>
‚Ä¢ Digite um <strong>c√≥digo EG</strong> para an√°lise completa<br>
‚Ä¢ <strong>/status</strong> para verificar status do sistema<br>
‚Ä¢ <strong>/dados</strong> para ver c√≥digos dispon√≠veis<br>
‚Ä¢ <strong>IA Conversacional:</strong> Converse naturalmente!<br><br>
<strong>üéØ Sistema DIRETA MG - An√°lise Autom√°tica:</strong><br>
‚Ä¢ An√°lise POSITIVA dos pontos fortes<br>
‚Ä¢ An√°lise NEGATIVA das oportunidades<br>
‚Ä¢ Recomenda√ß√µes estrat√©gicas<br>
‚Ä¢ Pr√≥ximos passos autom√°ticos<br><br>
<em>Sistema Raio-X Score 5 - Inspec√ß√£o inteligente!</em>`,
                "bot"
              );
            }, 1200);
            return;
          }

          if (messageLower === "/status" || messageLower === "status") {
            simulateTyping(() => {
              if (csvData.length === 0) {
                addMessage(
                  `<strong>üìä Sistema Raio-X Score 5</strong><br>
‚Ä¢ Status: ‚ö†Ô∏è <strong>Carregando dados...</strong><br>
‚Ä¢ IA: ‚úÖ <strong>An√°lise local ativa</strong><br>
‚Ä¢ Sistema: üöÄ <strong>Online</strong><br><br>
<em>Aguarde enquanto carregamos os dados.</em>`,
                  "bot"
                );
              } else {
                addMessage(
                  `<strong>üìä Sistema Raio-X Score 5</strong><br>
‚Ä¢ Status: ‚úÖ <strong>Online e funcionando</strong><br>
‚Ä¢ Dados: ‚úÖ <strong>${csvData.length} estabelecimentos</strong><br>
‚Ä¢ IA: ‚úÖ <strong>An√°lise inteligente local ativa</strong><br>
‚Ä¢ Interface: üöÄ <strong>Mobile-friendly</strong><br><br>
<em>DIRETA MG - Sistema operacional!</em>`,
                  "bot"
                );
              }
            }, 1000);
            return;
          }

          if (messageLower === "/dados" || messageLower === "dados") {
            if (csvData.length === 0) {
              simulateTyping(() => {
                addMessage(
                  `<strong>‚ùå Base de dados vazia</strong><br><br>
<em>Dados n√£o carregados.</em>`,
                  "bot"
                );
              }, 800);
              return;
            }

            simulateTyping(() => {
              let codesList = `<strong>üìã C√≥digos EG Dispon√≠veis (${csvData.length}):</strong><br><br>`;
              csvData.slice(0, 5).forEach((est) => {
                codesList += `<strong>${est.eg}</strong> - ${est.nome_fantasia} (${est.rede})<br>`;
              });
              codesList += `<br><em>üí° Digite qualquer c√≥digo EG para an√°lise completa!</em>`;

              addMessage(codesList, "bot");
            }, 800);
            return;
          }

          // IA conversacional
          let response = "";

          // Sauda√ß√µes
          if (
            messageLower.includes("oi") ||
            messageLower.includes("ol√°") ||
            messageLower.includes("hello")
          ) {
            response = `ü§ñ **Bem-vindo ao Raio-X Score 5!**
              
Sou o assistente de IA da DIRETA MG, especializado em an√°lise de performance de estabelecimentos.

üí° **Como posso ajudar:**
‚Ä¢ Digite um c√≥digo EG para an√°lise profissional
‚Ä¢ Use /ajuda para ver comandos
‚Ä¢ /dados para ver c√≥digos dispon√≠veis

üéØ **Experimente:** Digite um c√≥digo EG para ver an√°lise completa!`;
          } else if (
            messageLower.includes("como") &&
            (messageLower.includes("vai") || messageLower.includes("est√°"))
          ) {
            response = `üòä **Sistema funcionando perfeitamente!**

‚ö° **Status DIRETA MG:**
‚Ä¢ ‚úÖ IA ativada e processando dados
‚Ä¢ ‚úÖ Base de ${csvData.length} estabelecimentos ativa
‚Ä¢ ‚úÖ An√°lises autom√°ticas funcionando
‚Ä¢ ‚úÖ Sistema inteligente local ativo

üéØ **Funcionalidades ativas:**
‚Ä¢ An√°lise autom√°tica de c√≥digos EG
‚Ä¢ Identifica√ß√£o de pontos positivos
‚Ä¢ Detec√ß√£o de oportunidades
‚Ä¢ Recomenda√ß√µes estrat√©gicas

üß† **Teste o sistema:** Digite "${
              csvData[0]?.eg || "67285-8"
            }" para ver a an√°lise em a√ß√£o!`;
          } else {
            response = `ü§ñ **Rob√¥ DIRETA MG Respondeu!**

Entendi sua mensagem: "${message}"

üß† **IA DIRETA MG processando:**
Compreendo e estou aqui para ajudar com an√°lises completas de estabelecimentos!

üí° **Como posso ajudar especificamente:**
‚Ä¢ **${csvData.length} c√≥digos EG dispon√≠veis** ‚Üí Dados completos + an√°lise inteligente
‚Ä¢ **/ajuda** ‚Üí Ver todos os comandos
‚Ä¢ **/dados** ‚Üí Ver c√≥digos EG dispon√≠veis
‚Ä¢ **/status** ‚Üí Verificar sistema

üéØ **Funcionalidade principal:** Digite qualquer c√≥digo EG e a IA far√° an√°lise autom√°tica!`;
          }

          simulateTyping(() => {
            addMessage(response.replace(/\n/g, "<br>"), "bot");
          }, 2000);
        };

        // Buscar estabelecimento
        const searchEstabelecimento = (code) => {
          const data = findEstabelecimento(code);

          if (data) {
            // Dados b√°sicos primeiro
            addMessage(
              `<strong>‚úÖ C√≥digo ${code} encontrado!</strong><br><br>
<strong>üìä DADOS DO ESTABELECIMENTO:</strong><br>
‚Ä¢ <strong>EG:</strong> ${data.eg}<br>
‚Ä¢ <strong>Nome:</strong> ${data.nome_fantasia}<br>
‚Ä¢ <strong>Rede:</strong> ${data.rede}<br>
‚Ä¢ <strong>Coordenador:</strong> ${data.coordenador}<br>
‚Ä¢ <strong>Supervisor:</strong> ${data.supervisor_terceiro}<br>
‚Ä¢ <strong>GN:</strong> ${data.gn}<br>
‚Ä¢ <strong>SL/SC:</strong> ${data.sl_sc}<br>
‚Ä¢ <strong>AE:</strong> ${data.ae}<br>
‚Ä¢ <strong>M-1:</strong> ${data.m1}<br>
‚Ä¢ <strong>M0:</strong> ${data.m0}<br>
‚Ä¢ <strong>vs M-1:</strong> ${data.vs_m1}<br>
‚Ä¢ <strong>G√¥ndola:</strong> ${data.gondola}<br>
‚Ä¢ <strong>Ponto Extra:</strong> ${data.ponto_extra}<br>
‚Ä¢ <strong>Base Foco:</strong> ${data.base_foco}<br>
‚Ä¢ <strong>Corona:</strong> ${data.corona}<br>
‚Ä¢ <strong>Spaten:</strong> ${data.spaten}<br>
‚Ä¢ <strong>Stella:</strong> ${data.stella}<br>
‚Ä¢ <strong>COB HDW:</strong> ${data.cob_hdw}<br>
‚Ä¢ <strong>Atendimento:</strong> ${data.atendimento}<br>
‚Ä¢ <strong>Visita:</strong> ${data.visita_quinzenal}<br>
‚Ä¢ <strong>Loja:</strong> ${data.loja}<br><br>
<em>üöÄ Agora vou fazer an√°lise IA completa (positivos + negativos + recomenda√ß√µes)...</em>`,
              "bot"
            );

            // An√°lise ap√≥s mostrar dados
            setTimeout(() => {
              try {
                addMessage(
                  "ü§ñ **Processando an√°lise inteligente local...**",
                  "bot"
                );
                const analysis = getIntelligentAnalysis(data, code);
                addMessage(analysis, "bot");
              } catch (error) {
                console.error("Erro na an√°lise IA:", error);
                addMessage(
                  "<strong>‚ùå Erro:</strong> N√£o foi poss√≠vel processar a an√°lise. Tente novamente.",
                  "bot"
                );
              }
            }, 1500);
          } else {
            addMessage(
              `<strong>‚ùå C√≥digo ${code} n√£o encontrado</strong><br><br>
‚Ä¢ Verifique se o c√≥digo est√° correto<br>
‚Ä¢ Use <strong>/dados</strong> para ver c√≥digos dispon√≠veis<br>
‚Ä¢ Base de dados: <strong>${
                csvData.length
              } estabelecimentos carregados</strong><br><br>
<strong>üéØ C√≥digos EG dispon√≠veis:</strong><br>
${csvData
  .slice(0, 3)
  .map((est) => `‚Ä¢ ${est.eg} - ${est.nome_fantasia}`)
  .join("<br>")}<br><br>
<em>DIRETA MG - Sistema de consultas inteligente</em>`,
              "bot"
            );
          }
        };

        // Iniciar chat
        const startChat = () => {
          setIsWelcomeScreen(false);
          setTimeout(() => {
            addMessage(
              `ü§ñ **Bem-vindo ao Raio-X Score 5!**

Sou o assistente de IA da DIRETA MG, especializado em an√°lise de performance de estabelecimentos.

üí° **Como posso ajudar:**
‚Ä¢ Digite um c√≥digo EG para an√°lise profissional
‚Ä¢ Use /ajuda para ver comandos
‚Ä¢ /dados para ver c√≥digos dispon√≠veis

üéØ **Experimente:** Digite um c√≥digo EG para ver an√°lise completa!`,
              "bot"
            );
          }, 500);

          // Carregar dados em background
          setTimeout(() => {
            loadSheetData();
          }, 1000);
        };

        // Enviar mensagem
        const handleSubmit = async (e) => {
          e.preventDefault();
          const message = inputValue.trim();

          if (!message) {
            return;
          }

          setIsLoading(true);

          try {
            addMessage(`<strong>üë§ Voc√™:</strong> ${message}`, "user");
            await processMessage(message);
            setInputValue("");
          } catch (error) {
            console.error("Erro ao processar mensagem:", error);
            addMessage(
              "<strong>‚ùå Erro:</strong> N√£o foi poss√≠vel processar sua mensagem. Tente novamente.",
              "bot"
            );
          } finally {
            setIsLoading(false);
          }
        };

        // Enter no input
        const handleKeyPress = (e) => {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            const message = inputValue.trim();
            if (message) {
              handleSubmit(e);
            }
          }
        };

        // Efeito para criar part√≠culas ap√≥s renderiza√ß√£o
        React.useEffect(() => {
          const particles = createParticles();
          document.body.appendChild(particles);

          return () => {
            if (particles.parentNode) {
              particles.parentNode.removeChild(particles);
            }
          };
        }, []);

        return React.createElement("div", { className: "app" }, [
          // Video Background
          React.createElement(
            "div",
            {
              key: "video-background",
              className: "video-background",
            },
            [
              React.createElement("video", {
                key: "background-video",
                autoPlay: true,
                loop: true,
                muted: true,
                playsInline: true,
                src: "https://cdn.pixabay.com/video/2024/01/24/198018-906226540_large.mp4",
              }),
            ]
          ),

          // Tela de Boas-vindas
          isWelcomeScreen &&
            React.createElement(
              "div",
              {
                key: "welcome",
                className: "welcome-screen",
              },
              [
                React.createElement(
                  "div",
                  {
                    key: "content",
                    className: "welcome-content",
                  },
                  [
                    React.createElement(
                      "h1",
                      {
                        key: "title",
                        className: "welcome-title animate-fade-in-up",
                      },
                      "Raio-X Score 5"
                    ),

                    React.createElement(
                      "div",
                      {
                        key: "subtitle-container",
                        className: "subtitle-container",
                      },
                      [
                        React.createElement(
                          "p",
                          {
                            key: "subtitle",
                            className: "welcome-subtitle animate-fade-in-up",
                          },
                          subtitles[subtitleIndex]
                        ),
                      ]
                    ),

                    React.createElement(
                      "div",
                      {
                        key: "robot-container",
                        className: "robot-container",
                      },
                      [
                        React.createElement(
                          "div",
                          {
                            key: "robot-image",
                            className: "robot-image",
                          },
                          [
                            React.createElement("img", {
                              key: "robot-icon-large",
                              className: "robot-icon",
                              src: "https://cdn-icons-png.flaticon.com/128/1698/1698535.png",
                              alt: "Rob√¥ Raio-X Score 5",
                            }),
                          ]
                        ),
                      ]
                    ),

                    React.createElement(
                      "p",
                      {
                        key: "company-info",
                        className: "company-info animate-fade-in-up",
                      },
                      "Desenvolvido pela ",
                      React.createElement(
                        "span",
                        {
                          key: "company-name",
                          className: "company-name",
                        },
                        "DIRETA MG"
                      )
                    ),

                    React.createElement(
                      "button",
                      {
                        key: "start-button",
                        onClick: startChat,
                        className: "start-button animate-fade-in-up",
                      },
                      [
                        React.createElement("span", { key: "zap-icon" }, "‚ö°"),
                        "Iniciar Conversa",
                      ]
                    ),
                  ]
                ),
              ]
            ),

          // Chat Container
          !isWelcomeScreen &&
            React.createElement(
              "div",
              {
                key: "chat",
                className: "chat-container",
              },
              [
                React.createElement(
                  "div",
                  {
                    key: "phone-frame",
                    className: "phone-frame",
                  },
                  [
                    // Header
                    React.createElement(
                      "div",
                      {
                        key: "chat-header",
                        className: "chat-header",
                      },
                      [
                        React.createElement(
                          "div",
                          {
                            key: "header-info",
                            className: "header-info",
                          },
                          [
                            React.createElement(
                              "div",
                              {
                                key: "header-avatar",
                                className: "header-avatar",
                              },
                              [
                                React.createElement("img", {
                                  key: "header-bot",
                                  src: "https://cdn-icons-png.flaticon.com/128/1698/1698535.png",
                                  alt: "Rob√¥",
                                  style: { width: "24px", height: "24px" },
                                }),
                              ]
                            ),
                            React.createElement(
                              "div",
                              {
                                key: "header-text",
                                className: "header-text",
                              },
                              [
                                React.createElement(
                                  "h1",
                                  {
                                    key: "header-title",
                                    className: "header-title",
                                  },
                                  "Raio-X Score 5"
                                ),
                                React.createElement(
                                  "p",
                                  {
                                    key: "header-subtitle",
                                    className: "header-subtitle",
                                  },
                                  isSheetLoaded
                                    ? `${csvData.length} estabelecimentos carregados`
                                    : "Carregando dados..."
                                ),
                              ]
                            ),
                          ]
                        ),
                        React.createElement(
                          "button",
                          {
                            key: "close-button",
                            onClick: () => setIsWelcomeScreen(true),
                            className: "close-button",
                            title: "Fechar chat",
                          },
                          [React.createElement("span", { key: "close-x" }, "‚úï")]
                        ),
                      ]
                    ),

                    // Messages
                    React.createElement(
                      "div",
                      {
                        key: "messages-container",
                        className: "messages-container",
                      },
                      [
                        // Renderizar mensagens
                        ...messages.map((message, index) =>
                          React.createElement("div", {
                            key: `message-${index}`,
                            className: `message ${message.sender} animate-message-slide`,
                            dangerouslySetInnerHTML: {
                              __html: message.content,
                            },
                          })
                        ),

                        // Typing Indicator
                        isTyping &&
                          React.createElement(
                            "div",
                            {
                              key: "typing-indicator",
                              className: "typing-indicator",
                            },
                            [
                              React.createElement(
                                "div",
                                {
                                  key: "typing-dots",
                                  className: "typing-dots",
                                },
                                [
                                  React.createElement("span", {
                                    key: "dot-1",
                                    className: "typing-dot",
                                  }),
                                  React.createElement("span", {
                                    key: "dot-2",
                                    className: "typing-dot",
                                  }),
                                  React.createElement("span", {
                                    key: "dot-3",
                                    className: "typing-dot",
                                  }),
                                ]
                              ),
                              "IA est√° digitando...",
                            ]
                          ),

                        // Ref para scroll
                        React.createElement("div", {
                          key: "messages-end",
                          ref: messagesEndRef,
                        }),
                      ]
                    ),

                    // Input
                    React.createElement(
                      "div",
                      {
                        key: "input-container",
                        className: "input-container",
                      },
                      [
                        React.createElement(
                          "form",
                          {
                            key: "chat-form",
                            onSubmit: handleSubmit,
                            className: "chat-form",
                          },
                          [
                            React.createElement("input", {
                              key: "message-input",
                              ref: inputRef,
                              value: inputValue,
                              onChange: (e) => setInputValue(e.target.value),
                              onKeyDown: handleKeyPress,
                              type: "text",
                              placeholder: "Digite um c√≥digo EG ou comando...",
                              className: "message-input",
                              autoComplete: "off",
                            }),
                            React.createElement(
                              "button",
                              {
                                key: "send-button",
                                type: "submit",
                                className: "send-button",
                                disabled: isLoading,
                              },
                              [
                                React.createElement(
                                  "span",
                                  { key: "send-icon" },
                                  "‚û§"
                                ),
                              ]
                            ),
                          ]
                        ),
                      ]
                    ),
                  ]
                ),
              ]
            ),
        ]);
      }

      // Renderizar o app
      ReactDOM.render(
        React.createElement(App),
        document.getElementById("root")
      );
    </script>
  </body>
</html>
