<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de Inspe√ß√£o Sanit√°ria Raio-X Score 5 - An√°lise inteligente de estabelecimentos">
    <meta name="theme-color" content="#1e40af">
            <title>Raio-X Score 5 | Sistema de Inspe√ß√£o Sanit√°ria - ü§ñ Powered by Google AI</title>
            
            <!-- Favicon do rob√¥ -->
            <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ñ</text></svg>">
            <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ü§ñ</text></svg>">
    
    <!-- React e ReactDOM via CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <style>
        /* ============================================
           SISTEMA RAIO-X SCORE 5 - DESIGN PROFISSIONAL
           DIRETA MG - Interface Corporativa Moderna
           ============================================ */

        /* Reset e configura√ß√µes base */
        * {
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        html, body {
          height: 100%;
          font-family: 'Inter', 'Segoe UI', 'Roboto', sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
          overflow-x: hidden;
        }

        /* Design System de Cores Profissional */
        :root {
          /* Tema Profissional (Padr√£o) */
          --primary-color: #1e40af;
          --primary-light: #3b82f6;
          --primary-dark: #1e3a8a;
          --secondary-color: #64748b;
          --accent-color: #f59e0b;
          --accent-light: #fbbf24;
          --success-color: #10b981;
          --warning-color: #f59e0b;
          --error-color: #ef4444;
          
          /* Tons de cinza profissionais */
          --gray-50: #f8fafc;
          --gray-100: #f1f5f9;
          --gray-200: #e2e8f0;
          --gray-300: #cbd5e1;
          --gray-400: #94a3b8;
          --gray-500: #64748b;
          --gray-600: #475569;
          --gray-700: #334155;
          --gray-800: #1e293b;
          --gray-900: #0f172a;
          
          /* Backgrounds */
          --bg-primary: #ffffff;
          --bg-secondary: #f8fafc;
          --bg-tertiary: #f1f5f9;
          --bg-card: rgba(255, 255, 255, 0.95);
          --bg-glass: rgba(255, 255, 255, 0.1);
          
          /* Textos */
          --text-primary: #0f172a;
          --text-secondary: #475569;
          --text-tertiary: #64748b;
          --text-inverse: #ffffff;
          
          /* Bordas e sombras */
          --border-light: #e2e8f0;
          --border-medium: #cbd5e1;
          --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
          --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
          --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
          --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
          --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
          
          /* Transi√ß√µes */
          --transition-fast: 0.15s cubic-bezier(0.4, 0, 0.2, 1);
          --transition-normal: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
          --transition-slow: 0.5s cubic-bezier(0.4, 0, 0.2, 1);
          --transition-spring: 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
          
          /* Spacing profissional */
          --space-xs: 0.25rem;
          --space-sm: 0.5rem;
          --space-md: 1rem;
          --space-lg: 1.5rem;
          --space-xl: 2rem;
          --space-2xl: 3rem;
          --space-3xl: 4rem;
          
          /* Border radius corporativo */
          --radius-sm: 0.375rem;
          --radius-md: 0.5rem;
          --radius-lg: 0.75rem;
          --radius-xl: 1rem;
          --radius-2xl: 1.5rem;
        }

        /* Temas alternativos */
        .app.light {
          --bg-primary: #f8fafc;
          --bg-secondary: #ffffff;
          --bg-tertiary: #f1f5f9;
          --bg-card: rgba(255, 255, 255, 0.98);
          --text-primary: #1e293b;
          --text-secondary: #475569;
          --text-tertiary: #64748b;
          --primary-color: #3b82f6;
          --accent-color: #10b981;
        }

        .app.dark {
          --bg-primary: #0f172a;
          --bg-secondary: #1e293b;
          --bg-tertiary: #334155;
          --bg-card: rgba(30, 41, 59, 0.95);
          --text-primary: #f1f5f9;
          --text-secondary: #cbd5e1;
          --text-tertiary: #94a3b8;
          --primary-color: #60a5fa;
          --accent-color: #fbbf24;
          --border-light: #334155;
          --border-medium: #475569;
        }

        /* Aplica√ß√£o do tema */
        .app {
          min-height: 100vh;
          background: var(--bg-primary);
          color: var(--text-primary);
          transition: background-color var(--transition-normal), color var(--transition-normal);
          position: relative;
        }

        /* ============================================
           SISTEMA DE PART√çCULAS ELEGANTE
           ============================================ */
        .particles-canvas {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          z-index: -1;
          pointer-events: none;
          opacity: 0.6;
        }

        .app.light .particles-canvas {
          opacity: 0.4;
        }

        .app.dark .particles-canvas {
          opacity: 0.8;
        }

        /* ============================================
           BOT√ÉO DE TEMA PROFISSIONAL
           ============================================ */
        .theme-toggle {
          position: fixed;
          top: var(--space-xl);
          right: var(--space-xl);
          z-index: 1000;
          width: 48px;
          height: 48px;
          border: 1px solid var(--border-medium);
          border-radius: var(--radius-xl);
          background: var(--bg-card);
          backdrop-filter: blur(20px);
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: all var(--transition-normal);
          box-shadow: var(--shadow-lg);
          color: var(--text-primary);
        }

        .theme-toggle:hover {
          transform: translateY(-2px);
          box-shadow: var(--shadow-xl);
          border-color: var(--primary-color);
        }

        .theme-toggle:active {
          transform: translateY(0);
        }

        .app.light .theme-toggle {
          background: rgba(255, 255, 255, 0.9);
        }

        .app.dark .theme-toggle {
          background: rgba(30, 41, 59, 0.9);
        }

        /* ============================================
           TELA DE BOAS-VINDAS PROFISSIONAL
           ============================================ */
        .welcome-screen {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          min-height: 100vh;
          padding: var(--space-xl);
          position: relative;
          background: linear-gradient(135deg, 
            var(--bg-primary) 0%, 
            var(--bg-secondary) 50%, 
            var(--bg-tertiary) 100%);
        }

        .welcome-bg-pattern {
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          opacity: 0.05;
          background-image: 
            radial-gradient(circle at 25% 25%, var(--primary-color) 0%, transparent 50%),
            radial-gradient(circle at 75% 75%, var(--accent-color) 0%, transparent 50%),
            radial-gradient(circle at 50% 50%, var(--secondary-color) 0%, transparent 30%);
          animation: patternFloat 20s ease-in-out infinite;
        }

        @keyframes patternFloat {
          0%, 100% { 
            transform: translateY(0) scale(1); 
            opacity: 0.05;
          }
          50% { 
            transform: translateY(-20px) scale(1.02); 
            opacity: 0.08;
          }
        }

        .welcome-content {
          text-align: center;
          max-width: 600px;
          z-index: 1;
        }

        .welcome-title {
          font-size: 3.5rem;
          font-weight: 800;
          margin-bottom: var(--space-lg);
          background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
          letter-spacing: -0.02em;
          line-height: 1.1;
        }

        .subtitle-container {
          height: 2.5rem;
          margin-bottom: var(--space-2xl);
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .welcome-subtitle {
          font-size: 1.25rem;
          font-weight: 500;
          color: var(--text-secondary);
          transition: all var(--transition-slow);
        }

        .robot-container {
          margin: var(--space-2xl) 0;
          display: flex;
          justify-content: center;
        }

        .robot-image {
          width: 140px;
          height: 140px;
          border-radius: var(--radius-2xl);
          background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
          display: flex;
          align-items: center;
          justify-content: center;
          box-shadow: var(--shadow-2xl);
          transition: all var(--transition-normal);
        }

        .robot-image:hover {
          transform: translateY(-4px) scale(1.05);
          box-shadow: 0 30px 60px rgba(30, 64, 175, 0.3);
        }

        .robot-icon {
          color: white;
          filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .company-info {
          font-size: 1.125rem;
          color: var(--text-tertiary);
          margin-bottom: var(--space-2xl);
          font-weight: 500;
        }

        .company-name {
          color: var(--primary-color);
          font-weight: 700;
        }

        .start-button {
          display: inline-flex;
          align-items: center;
          gap: var(--space-sm);
          background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
          color: white;
          border: none;
          padding: var(--space-lg) var(--space-2xl);
          font-size: 1.125rem;
          font-weight: 600;
          border-radius: var(--radius-xl);
          cursor: pointer;
          transition: all var(--transition-normal);
          box-shadow: var(--shadow-lg);
          text-transform: uppercase;
          letter-spacing: 0.05em;
          position: relative;
          overflow: hidden;
        }

        .start-button::before {
          content: '';
          position: absolute;
          top: 0;
          left: -100%;
          width: 100%;
          height: 100%;
          background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
          transition: left 0.6s;
        }

        .start-button:hover {
          transform: translateY(-2px);
          box-shadow: var(--shadow-xl);
        }

        .start-button:hover::before {
          left: 100%;
        }

        .start-button:active {
          transform: translateY(0);
        }

        /* ============================================
           CHAT CONTAINER PROFISSIONAL
           ============================================ */
        .chat-container {
          display: flex;
          justify-content: center;
          align-items: center;
          min-height: 100vh;
          padding: var(--space-lg);
          background: var(--bg-primary);
        }

        .phone-frame {
          width: 100%;
          max-width: 400px;
          height: 90vh;
          max-height: 700px;
          background: var(--bg-card);
          border-radius: var(--radius-2xl);
          box-shadow: var(--shadow-2xl);
          border: 1px solid var(--border-light);
          overflow: hidden;
          display: flex;
          flex-direction: column;
          backdrop-filter: blur(20px);
          position: relative;
        }

        @media (min-width: 768px) {
          .phone-frame {
            width: 420px;
            height: 85vh;
          }
        }

        /* Header profissional */
        .chat-header {
          background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
          padding: var(--space-lg);
          display: flex;
          align-items: center;
          justify-content: space-between;
          color: white;
          position: relative;
          box-shadow: var(--shadow-md);
        }

        .chat-header::before {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          height: 1px;
          background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
        }

        .header-info {
          display: flex;
          align-items: center;
          gap: var(--space-md);
        }

        .header-avatar {
          width: 48px;
          height: 48px;
          background: rgba(255, 255, 255, 0.2);
          border-radius: var(--radius-xl);
          display: flex;
          align-items: center;
          justify-content: center;
          backdrop-filter: blur(10px);
          border: 1px solid rgba(255, 255, 255, 0.1);
          transition: all var(--transition-normal);
        }

        .header-avatar:hover {
          transform: scale(1.05);
          background: rgba(255, 255, 255, 0.25);
        }

        .header-text {
          flex: 1;
        }

        .header-title {
          font-size: 1.125rem;
          font-weight: 700;
          margin-bottom: 2px;
          color: white;
        }

        .header-subtitle {
          font-size: 0.75rem;
          font-weight: 500;
          color: rgba(255, 255, 255, 0.8);
          text-transform: uppercase;
          letter-spacing: 0.05em;
        }

        .close-button {
          width: 36px;
          height: 36px;
          border: none;
          background: rgba(255, 255, 255, 0.2);
          border-radius: var(--radius-lg);
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: all var(--transition-normal);
          color: white;
        }

        .close-button:hover {
          background: rgba(255, 255, 255, 0.3);
          transform: scale(1.1);
        }

        /* Container de mensagens */
        .messages-container {
          flex: 1;
          overflow-y: auto;
          padding: var(--space-lg);
          background: var(--bg-secondary);
          display: flex;
          flex-direction: column;
          gap: var(--space-md);
          scrollbar-width: thin;
          scrollbar-color: var(--primary-color) transparent;
        }

        .messages-container::-webkit-scrollbar {
          width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
          background: transparent;
        }

        .messages-container::-webkit-scrollbar-thumb {
          background: var(--primary-color);
          border-radius: 3px;
          opacity: 0.3;
        }

        /* Mensagens profissionais */
        .message {
          max-width: 85%;
          padding: var(--space-md) var(--space-lg);
          border-radius: var(--radius-xl);
          line-height: 1.6;
          font-size: 0.875rem;
          animation: messageSlide 0.4s ease-out;
          position: relative;
          word-wrap: break-word;
          box-shadow: var(--shadow-sm);
        }

        @keyframes messageSlide {
          from {
            opacity: 0;
            transform: translateY(20px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        .message.user {
          align-self: flex-end;
          background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
          color: white;
          border-bottom-right-radius: var(--radius-sm);
          font-weight: 600;
        }

        .message.user strong {
          color: white;
        }

        .message.bot {
          align-self: flex-start;
          background: var(--bg-card);
          color: var(--text-primary);
          border: 1px solid var(--border-light);
          border-bottom-left-radius: var(--radius-sm);
          backdrop-filter: blur(10px);
        }

        .message.bot strong {
          color: var(--primary-color);
          font-weight: 700;
        }

        /* Indicador de digita√ß√£o */
        .typing-indicator {
          display: flex;
          align-items: center;
          gap: var(--space-sm);
          padding: var(--space-md) var(--space-lg);
          background: var(--bg-card);
          color: var(--text-secondary);
          border-radius: var(--radius-xl);
          border: 1px solid var(--border-light);
          font-size: 0.875rem;
          font-weight: 500;
          align-self: flex-start;
          max-width: fit-content;
          backdrop-filter: blur(10px);
        }

        .typing-dots {
          display: flex;
          gap: 4px;
        }

        .typing-dot {
          width: 6px;
          height: 6px;
          background: var(--primary-color);
          border-radius: 50%;
          animation: typingPulse 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingPulse {
          0%, 100% { 
            transform: scale(1); 
            opacity: 1; 
          }
          50% { 
            transform: scale(1.2); 
            opacity: 0.7; 
          }
        }

        /* Input container profissional */
        .input-container {
          background: var(--bg-card);
          padding: var(--space-lg);
          border-top: 1px solid var(--border-light);
          backdrop-filter: blur(20px);
        }

        .chat-form {
          display: flex;
          gap: var(--space-md);
          align-items: center;
        }

        .message-input {
          flex: 1;
          padding: var(--space-md) var(--space-lg);
          background: var(--bg-tertiary);
          border: 2px solid transparent;
          border-radius: var(--radius-xl);
          color: var(--text-primary);
          font-size: 0.875rem;
          font-weight: 500;
          outline: none;
          transition: all var(--transition-normal);
          box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .message-input:focus {
          border-color: var(--primary-color);
          background: var(--bg-secondary);
          box-shadow: 
            inset 0 1px 2px rgba(0, 0, 0, 0.05),
            0 0 0 4px rgba(30, 64, 175, 0.1);
        }

        .message-input::placeholder {
          color: var(--text-tertiary);
          font-weight: 400;
        }

        .send-button {
          width: 48px;
          height: 48px;
          background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
          border: none;
          border-radius: var(--radius-xl);
          color: white;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all var(--transition-normal);
          box-shadow: var(--shadow-md);
        }

        .send-button:hover:not(:disabled) {
          transform: translateY(-2px);
          box-shadow: var(--shadow-lg);
        }

        .send-button:active {
          transform: translateY(0);
        }

        .send-button:disabled {
          opacity: 0.4;
          cursor: not-allowed;
          background: linear-gradient(135deg, #9ca3af, #6b7280);
        }

        /* ============================================
           ANIMA√á√ïES PROFISSIONAIS
           ============================================ */
        .animate-fade-in-up {
          animation: fadeInUp 0.8s ease-out forwards;
        }

        @keyframes fadeInUp {
          from { 
            opacity: 0; 
            transform: translateY(40px); 
          }
          to { 
            opacity: 1; 
            transform: translateY(0); 
          }
        }

        .animate-bounce-gentle {
          animation: bounceGentle 3s ease-in-out infinite;
        }

        @keyframes bounceGentle {
          0%, 100% { 
            transform: translateY(0); 
          }
          50% { 
            transform: translateY(-8px); 
          }
        }

        .animate-message-slide {
          animation: messageSlide 0.4s ease-out;
        }

        /* ============================================
           RESPONSIVIDADE PROFISSIONAL
           ============================================ */
        @media (max-width: 640px) {
          .welcome-title {
            font-size: 2.5rem;
          }
          
          .welcome-subtitle {
            font-size: 1.125rem;
          }
          
          .robot-image {
            width: 120px;
            height: 120px;
          }
          
          .chat-container {
            padding: var(--space-sm);
          }
          
          .phone-frame {
            height: 95vh;
            max-height: none;
          }
          
          .message {
            font-size: 0.8rem;
          }
          
          .theme-toggle {
            top: var(--space-md);
            right: var(--space-md);
            width: 44px;
            height: 44px;
          }
        }

        /* Estados de loading */
        .loading {
          opacity: 0.7;
          pointer-events: none;
        }

        .loading .send-button {
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }

        /* Melhorias de acessibilidade */
        @media (prefers-reduced-motion: reduce) {
          * {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
          }
        }

        /* Estados de focus melhorados */
        button:focus-visible,
        input:focus-visible {
          outline: 2px solid var(--primary-color);
          outline-offset: 2px;
        }

        /* Melhorias para dispositivos de alta DPI */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
          .robot-image,
          .header-avatar {
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
          }
        }

        /* Print styles */
        @media print {
          .particles-canvas,
          .theme-toggle,
          .start-button,
          .send-button,
          .close-button {
            display: none !important;
          }
          
          .chat-container {
            min-height: auto;
          }
          
          .phone-frame {
            box-shadow: none;
            border: 1px solid #000;
          }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // Configura√ß√£o da API Google AI
        const GOOGLE_AI_API_KEY = "AIzaSyBTZiUDC2INIspbdFm6R3dZX1A4ls7olSI";
        const GOOGLE_AI_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent";

        // URL da planilha Google Sheets - Planilha CSV configurada
        const GOOGLE_SHEET_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQZiOyvly3nMqoNnJSj7_is0d-mMGGXmeIpXfYEHL2SqQAfNQ5tU4oOsNQsOhi7TKjcBxy2XoWmt2oe/pub?output=csv";

        // Componente React principal
        function App() {
          const [isWelcomeScreen, setIsWelcomeScreen] = React.useState(true);
          const [messages, setMessages] = React.useState([]);
          const [inputValue, setInputValue] = React.useState('');
          const [isLoading, setIsLoading] = React.useState(false);
          const [csvData, setCsvData] = React.useState([]);
          const [isSheetLoaded, setIsSheetLoaded] = React.useState(false);
          const [isTyping, setIsTyping] = React.useState(false);
          const [currentTheme, setCurrentTheme] = React.useState('professional');
          const [subtitleIndex, setSubtitleIndex] = React.useState(0);

          // Refs
          const messagesEndRef = React.useRef(null);
          const inputRef = React.useRef(null);

          // Subt√≠tulos animados
          const subtitles = [
            "Sistema de An√°lise de Performance",
            "238 Estabelecimentos Monitorados",
            "IA Conversacional Avan√ßada",
            "Relat√≥rios Estrat√©gicos Autom√°ticos"
          ];

          // Fun√ß√£o para adicionar mensagens
          const addMessage = (content, sender) => {
            const newMessage = {
              content,
              sender,
              timestamp: new Date()
            };
            setMessages(prev => [...prev, newMessage]);
          };

          // Fun√ß√£o para scroll autom√°tico
          const scrollToBottom = () => {
            if (messagesEndRef.current) {
              messagesEndRef.current.scrollIntoView({ behavior: "smooth" });
            }
          };

          React.useEffect(() => {
            scrollToBottom();
          }, [messages, isTyping]);

          // Fun√ß√£o para anima√ß√£o do subt√≠tulo
          React.useEffect(() => {
            const interval = setInterval(() => {
              setSubtitleIndex(prev => (prev + 1) % subtitles.length);
            }, 4000);

            return () => clearInterval(interval);
          }, []);

          // Fun√ß√£o para carregar dados da planilha - VERS√ÉO DIRETA COM FEEDBACK
          const loadSheetData = async () => {
            if (isSheetLoaded) return;

            // URLs alternativas para tentar
            const urls = [
              window.GOOGLE_SHEET_CSV_URL || GOOGLE_SHEET_CSV_URL,
              "https://docs.google.com/spreadsheets/d/1QZiOyvly3nMqoNnJSj7_is0d-mMGGXmeIpXfYEHL2SqQAfNQ5tU4oOsNQsOhi7TKjcBxy2XoWmt2oe/export?format=csv&gid=0",
              "https://docs.google.com/spreadsheets/d/1QZiOyvly3nMqoNnJSj7_is0d-mMGGXmeIpXfYEHL2SqQAfNQ5tU4oOsNQsOhi7TKjcBxy2XoWmt2oe/export?format=csv",
            ];

            let lastError = null;
            
            // Tentar cada URL
            for (let i = 0; i < urls.length; i++) {
              const currentUrl = urls[i];
              
              try {
                console.log(`üìä Tentativa ${i + 1}/${urls.length} - Carregando planilha Google Sheets...`);
                console.log('üåê URL utilizada:', currentUrl);
                
                const response = await fetch(currentUrl, {
                  method: 'GET',
                  mode: 'cors',
                  redirect: 'follow',  // Seguir redirecionamentos automaticamente
                  headers: { 
                    'Accept': 'text/csv, text/plain, text/html, */*',
                    'Cache-Control': 'no-cache'
                  }
                });
                
                if (!response.ok) {
                  throw new Error(`HTTP ${response.status} - A planilha n√£o est√° acess√≠vel`);
                }
                
                const text = await response.text();
                console.log('üìÑ Resposta da planilha (primeiros 300 chars):', text.substring(0, 300));
              
              // Verificar se √© CSV v√°lido
              if (text && text.length > 100 && !text.startsWith('<') && !text.toLowerCase().includes('error')) {
                const lines = text.split('\n').filter(line => line.trim());
                if (lines.length > 1) {
                  console.log('üìù Processando dados CSV...');
                  const parsedData = parseCSVRobust(text);
                  
                  if (parsedData.length > 1) {
                    const processedData = parsedData.slice(1).map(row => {
                      const obj = {};
                      const headers = parsedData[0];
                      
                      // Mapear colunas
                      headers.forEach((header, index) => {
                        const key = header.trim().toLowerCase();
                        const value = (row[index] || '').trim();
                        
                        if (key === 'eg' || key === 'c√≥digo' || key === 'code') {
                          obj.eg = value;
                        } else if (key === 'nome fantasia' || key === 'nome' || key === 'estabelecimento') {
                          obj.nome_fantasia = value;
                        } else if (key === 'rede') {
                          obj.rede = value;
                        } else if (key === 'coordenador') {
                          obj.coordenador = value;
                        } else if (key === 'supervisor terceiro' || key === 'supervisor') {
                          obj.supervisor_terceiro = value;
                        } else if (key === 'gn') {
                          obj.gn = value;
                        } else if (key === 'sl/sc' || key === 'sl/sc') {
                          obj.sl_sc = value;
                        } else if (key === 'ae') {
                          obj.ae = value;
                        } else if (key === 'm-1' || key === 'm-1' || key === 'm1') {
                          obj.m1 = value;
                        } else if (key === 'm0') {
                          obj.m0 = value;
                        } else if (key === 'vs m-1' || key === 'vs m-1' || key === 'vs m1') {
                          obj.vs_m1 = value;
                        } else if (key === 'g√¥ndola' || key === 'gondola') {
                          obj.gondola = value;
                        } else if (key === 'ponto extra') {
                          obj.ponto_extra = value;
                        } else if (key === 'base foco' || key === 'base_foco') {
                          obj.base_foco = value;
                        } else if (key === 'corona') {
                          obj.corona = value;
                        } else if (key === 'spaten') {
                          obj.spaten = value;
                        } else if (key === 'stella') {
                          obj.stella = value;
                        } else if (key === 'cob hdw' || key === 'cob_hdw') {
                          obj.cob_hdw = value;
                        } else if (key === 'atendimento') {
                          obj.atendimento = value;
                        } else if (key === 'visita quinzenal' || key === 'visita_quinzenal') {
                          obj.visita_quinzenal = value;
                        } else if (key === 'loja') {
                          obj.loja = value;
                        }
                      });
                      
                      return obj;
                    }).filter(item => item.eg && item.eg.trim() !== '');
                    
                    console.log(`‚úÖ Planilha carregada com ${processedData.length} estabelecimentos`);
                    setCsvData(processedData);
                    setIsSheetLoaded(true);
                    
                    // Notificar sucesso
                    if (processedData.length > 0) {
                      addMessage(`<strong>‚úÖ Sistema Raio-X Score 5 Ativo!</strong><br><br>
üéØ <strong>Sistema 100% Operacional!</strong><br>
Digite o c√≥digo EG de qualquer estabelecimento para an√°lise completa.`, 'bot');
                    }
                    return;
                  } else {
                    throw new Error('Planilha n√£o cont√©m dados v√°lidos');
                  }
                } else {
                  throw new Error('Planilha n√£o cont√©m linhas de dados');
                }
              } else {
                throw new Error('Resposta n√£o √© um CSV v√°lido');
              }
              
              } catch (error) {
                console.log(`‚ùå Tentativa ${i + 1} falhou:`, error.message);
                lastError = error;
                continue; // Tentar pr√≥ximo URL
              }
            }
            
            // Se chegou aqui, todas as URLs falharam
            console.error('‚ùå Todas as tentativas de carregamento falharam:', lastError);
            setCsvData([]);
            setIsSheetLoaded(true);
            
            // Notificar erro
            addMessage(`<strong>‚ùå Erro no Sistema</strong><br><br>
Tente novamente em alguns instantes ou entre em contato com o suporte.`, 'bot');
          };

          // Fun√ß√£o parseCSV robusta e melhorada
          const parseCSVRobust = (text) => {
            const lines = [];
            const rawLines = text.trim().split('\n').filter(line => line.trim());
            
            for (const line of rawLines) {
              const row = [];
              let cell = '';
              let inQuote = false;
              const cleanLine = line.replace(/\r$/, '');
              
              for (let i = 0; i < cleanLine.length; i++) {
                const char = cleanLine[i];
                if (char === '"') {
                  if (inQuote && cleanLine[i + 1] === '"') {
                    // Escape de aspas duplas
                    cell += '"';
                    i++;
                  } else {
                    inQuote = !inQuote;
                  }
                } else if (char === ',' && !inQuote) {
                  row.push(cell.trim());
                  cell = '';
                } else {
                  cell += char;
                }
              }
              row.push(cell.trim());
              lines.push(row);
            }
            
            return lines;
          };

          // Fun√ß√£o para buscar estabelecimento - VERS√ÉO CORRIGIDA
          const findEstabelecimento = (code) => {
            if (!code || !csvData.length) return null;
            
            const normalizedCode = code.trim().toUpperCase();
            console.log('üîç Buscando c√≥digo:', normalizedCode);
            console.log('üìä Total de estabelecimentos:', csvData.length);
            
            if (csvData.length > 0) {
              console.log('üìù Primeiros c√≥digos dispon√≠veis:', csvData.slice(0, 3).map(est => est.eg));
            }
            
            // Busca exata
            let found = csvData.find(estabelecimento => {
              const estabelecimentoCode = (estabelecimento.eg || '').toUpperCase().trim();
              return estabelecimentoCode === normalizedCode;
            });
            
            // Se n√£o encontrou, busca parcial
            if (!found) {
              found = csvData.find(estabelecimento => {
                const estabelecimentoCode = (estabelecimento.eg || '').toUpperCase().trim();
                return estabelecimentoCode.includes(normalizedCode) || normalizedCode.includes(estabelecimentoCode);
              });
            }
            
            console.log('‚úÖ Resultado da busca:', found);
            return found;
          };

          // Fun√ß√£o para an√°lise com Google AI Gemini
          const analyzeWithGeminiAI = async (data, code) => {
            try {
              console.log('ü§ñ Iniciando an√°lise com Google AI Gemini...');
              
              const prompt = `Voc√™ √© um analista de neg√≥cios especializado em performance de estabelecimentos comerciais. 

Analise os dados do estabelecimento ${code} e forne√ßa uma an√°lise profissional e estrat√©gica:

ESTABELECIMENTO: ${data.nome_fantasia || 'N√£o informado'}
REDE: ${data.rede || 'N√£o informado'}
COORDENADOR: ${data.coordenador || 'N√£o informado'}

INDICADORES DE PERFORMANCE:
- M-1: ${data.m1 || 'N√£o informado'}
- M0: ${data.m0 || 'N√£o informado'} 
- vs M-1: ${data.vs_m1 || 'N√£o informado'}
- G√¥ndola: ${data.gondola || 'N√£o informado'}
- Ponto Extra: ${data.ponto_extra || 'N√£o informado'}

IMPLEMENTA√á√ïES:
- AE (Atendimento Especial): ${data.ae || 'N√£o informado'}
- Corona: ${data.corona || 'N√£o informado'}
- Spaten: ${data.spaten || 'N√£o informado'}
- Stella: ${data.stella || 'N√£o informado'}
- COB HDW: ${data.cob_hdw || 'N√£o informado'}

Forne√ßa uma an√°lise completa com:
1. PONTOS FORTES (2-3 aspectos principais)
2. OPORTUNIDADES DE MELHORIA (2-3 pontos cr√≠ticos) 
3. RECOMENDA√á√ïES ESTRAT√âGICAS (3-5 a√ß√µes pr√°ticas)
4. PR√ìXIMOS PASSOS (cronograma sugerido)

Responda em portugu√™s brasileiro, de forma profissional e objetiva. Use emojis para tornar mais visual.`;

              const requestBody = {
                contents: [{
                  parts: [{ text: prompt }]
                }],
                generationConfig: {
                  temperature: 0.7,
                  topK: 40,
                  topP: 0.95,
                  maxOutputTokens: 1024,
                }
              };

              const response = await fetch(`${GOOGLE_AI_URL}?key=${GOOGLE_AI_API_KEY}`, {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody)
              });

              if (!response.ok) {
                throw new Error(`Erro na API Google AI: ${response.status}`);
              }

              const result = await response.json();
              
              if (result.candidates && result.candidates[0] && result.candidates[0].content) {
                const aiResponse = result.candidates[0].content.parts[0].text;
                console.log('‚úÖ An√°lise AI gerada com sucesso');
                return aiResponse;
              } else {
                throw new Error('Resposta inv√°lida da API Google AI');
              }
            } catch (error) {
              console.error('‚ùå Erro na an√°lise com IA:', error.message);
              // Fallback para an√°lise baseada em regras
              console.log('üîÑ Usando an√°lise de fallback...');
              return getIntelligentAnalysis(data, code);
            }
          };

          // Fun√ß√£o para an√°lise inteligente (baseada em regras)
          const getIntelligentAnalysis = (data, code) => {
            const nome = data.nome_fantasia || 'N√£o informado';
            const rede = data.rede || 'N√£o informado';
            const ae = data.ae || '';
            const m1 = data.m1 || '';
            const m0 = data.m0 || '';
            const vs_m1 = data.vs_m1 || '';
            const gondola = data.gondola || '';
            const pontoExtra = data.ponto_extra || '';
            const coordenador = data.coordenador || 'N√£o informado';
            const sl_sc = data.sl_sc || '';
            const gn = data.gn || '';
            const base_foco = data.base_foco || '';
            const corona = data.corona || '';
            const spaten = data.spaten || '';
            const stella = data.stella || '';
            const cob_hdw = data.cob_hdw || '';
            const atendimento = data.atendimento || '';
            const visita_quinzenal = data.visita_quinzenal || '';
            
            // Converter valores num√©ricos
            const parsePercentage = (val) => {
              if (!val || val === '') return 0;
              const clean = val.replace('%', '').replace(',', '.');
              return parseFloat(clean) || 0;
            };
            
            const m0Value = parsePercentage(m0);
            const vs_m1Value = parsePercentage(vs_m1);
            const gondolaValue = parsePercentage(gondola);
            const pontoExtraValue = parsePercentage(pontoExtra);
            
            let positives = [];
            let negatives = [];
            let recommendations = [];
            
            // An√°lise POSITIVA
            if (vs_m1 && vs_m1Value > 0) {
              positives.push(`üìà **Crescimento de ${vs_m1}** no per√≠odo M0 vs M-1`);
            }
            
            if (m0 && m0Value > 60) {
              positives.push(`üöÄ **Performance M0 excelente** com ${m0}`);
            } else if (m0 && m0Value > 45) {
              positives.push(`‚úÖ **Performance M0 satisfat√≥ria** com ${m0}`);
            }
            
            if (ae === 'SIM') {
              positives.push(`‚≠ê **Atendimento Especial ativo** - Destaque no atendimento`);
            }
            
            if (gondola && gondolaValue > 50) {
              positives.push(`üéØ **G√¥ndola excelente** com ${gondola}`);
            } else if (gondola && gondolaValue > 35) {
              positives.push(`üëç **G√¥ndola boa** com ${gondola}`);
            }
            
            if (pontoExtra && pontoExtraValue > 50) {
              positives.push(`üí° **Ponto Extra eficaz** com ${pontoExtra}`);
            }
            
            if (corona === 'OK') positives.push(`‚úÖ **Corona implementada** corretamente`);
            if (spaten === 'OK') positives.push(`‚úÖ **Spaten implementada** corretamente`);
            if (stella === 'OK') positives.push(`‚úÖ **Stella implementada** corretamente`);
            if (cob_hdw === 'OK') positives.push(`‚úÖ **COB HDW implementado** corretamente`);
            
            if (visita_quinzenal === 'OK') {
              positives.push(`üìÖ **Visitas quinzenais regulares** mantidas`);
            }
            
            // An√°lise NEGATIVA
            if (vs_m1 && vs_m1Value < 0) {
              negatives.push(`‚ö†Ô∏è **Queda de ${Math.abs(vs_m1Value).toFixed(1)}%** no per√≠odo vs M-1`);
            }
            
            if (m0 && m0Value < 45) {
              negatives.push(`üîª **Performance M0 baixa** - apenas ${m0} (meta: 50%+)`);
            }
            
            if (ae === 'N√ÉO') {
              negatives.push(`üìâ **Atendimento Especial inativo** - oportunidade de melhoria`);
            }
            
            if (gondola && gondolaValue < 30) {
              negatives.push(`‚ùå **G√¥ndola insuficiente** - apenas ${gondola} (meta: 50%+)`);
            }
            
            if (pontoExtra && pontoExtraValue < 30) {
              negatives.push(`üö´ **Ponto Extra limitado** - apenas ${pontoExtra} (meta: 50%+)`);
            }
            
            if (corona === 'NOK') negatives.push(`‚ùå **Corona n√£o implementada**`);
            if (spaten === 'NOK') negatives.push(`‚ùå **Spaten n√£o implementada**`);
            if (stella === 'NOK') negatives.push(`‚ùå **Stella n√£o implementada**`);
            if (cob_hdw === 'NOK') negatives.push(`‚ùå **COB HDW n√£o implementado**`);
            
            if (atendimento === 'N√ÉO') negatives.push(`üìã **Atendimento em melhoria necess√°ria**`);
            
            // Recomenda√ß√µes
            if (vs_m1Value < 0) {
              recommendations.push(`üìã **Plano de Recupera√ß√£o**: Implementar estrat√©gias para reverter a tend√™ncia negativa`);
            }
            
            if (m0Value < 50) {
              recommendations.push(`üéØ **Meta Performance**: Foco em atingir 50%+ pontos M0`);
            }
            
            if (gondolaValue < 50) {
              recommendations.push(`üè™ **Otimiza√ß√£o G√¥ndola**: Revisar distribui√ß√£o e produtos, meta 50%+`);
            }
            
            if (ae === 'N√ÉO') {
              recommendations.push(`ü§ù **Programa Especial**: Ativar Atendimento Especial AE`);
            }
            
            if (corona === 'NOK' || spaten === 'NOK' || stella === 'NOK') {
              recommendations.push(`üç∫ **Implementa√ß√£o Premium**: Resolver pend√™ncias Corona/Spaten/Stella`);
            }
            
            recommendations.push(`üìû **Acompanhamento**: Contatar coordenador ${coordenador} para planejamento`);
            
            // Construir resposta
            let response = `<strong>üè¢ AN√ÅLISE COMPLETA - ${code}</strong><br><br>`;
            response += `<strong>üìä ESTABELECIMENTO:</strong><br>`;
            response += `‚Ä¢ <strong>Nome:</strong> ${nome}<br>`;
            response += `‚Ä¢ <strong>Rede:</strong> ${rede}<br>`;
            response += `‚Ä¢ <strong>Coordenador:</strong> ${coordenador}<br>`;
            response += `‚Ä¢ <strong>SL/SC:</strong> ${sl_sc}<br>`;
            response += `‚Ä¢ <strong>AE:</strong> ${ae}<br>`;
            response += `‚Ä¢ <strong>M-1:</strong> ${m1} | <strong>M0:</strong> ${m0} | <strong>vs M-1:</strong> ${vs_m1}<br>`;
            response += `‚Ä¢ <strong>G√¥ndola:</strong> ${gondola} | <strong>GN:</strong> ${gn} | <strong>Ponto Extra:</strong> ${pontoExtra}<br><br>`;
            
            response += `<strong>‚úÖ PONTOS FORTES (Positivos):</strong><br>`;
            if (positives.length > 0) {
              positives.forEach(pos => {
                response += `${pos}<br>`;
              });
            } else {
              response += `üìã Estabelecimento com base s√≥lida, buscar incremento nos indicadores<br>`;
            }
            response += `<br>`;
            
            response += `<strong>‚ö†Ô∏è OPORTUNIDADES (Pontos de Melhoria):</strong><br>`;
            if (negatives.length > 0) {
              negatives.forEach(neg => {
                response += `${neg}<br>`;
              });
            } else {
              response += `üéâ Excelente performance! Todos os indicadores acima da m√©dia<br>`;
            }
            response += `<br>`;
            
            response += `<strong>üí° RECOMENDA√á√ïES ESTRAT√âGICAS:</strong><br>`;
            recommendations.forEach(rec => {
              response += `${rec}<br>`;
            });
            response += `<br>`;
            
            response += `<strong>üéØ PR√ìXIMOS PASSOS:</strong><br>`;
            response += `‚Ä¢ ${vs_m1Value >= 0 ? '‚úÖ Manter' : 'üîÑ Revisar'} estrat√©gia atual<br>`;
            response += `‚Ä¢ ${gondolaValue >= 50 ? '‚úÖ Expandir' : 'üìà Desenvolver'} pol√≠ticas de g√¥ndola<br>`;
            response += `‚Ä¢ üìä Monitorar evolu√ß√£o mensal dos indicadores<br>`;
            response += `‚Ä¢ ü§ù Agendar visita t√©cnica com supervisor<br>`;
            response += `‚Ä¢ üç∫ Verificar implementa√ß√£o Corona/Spaten/Stella<br><br>`;
            
            response += `<em>ü§ñ An√°lise DIRETA MG - Sistema Inteligente Raio-X Score 5</em>`;
            
            return response;
          };

          // Simular typing
          const simulateTyping = (callback, delay = 2000) => {
            setIsTyping(true);
            setTimeout(() => {
              setIsTyping(false);
              callback();
            }, delay);
          };

          // Processar mensagem
          const processMessage = async (message) => {
            const messageLower = message.toLowerCase().trim();
            
            // Verificar se √© um c√≥digo EG
            const egPattern = /\d{2,6}-\d/;
            
            if (egPattern.test(message)) {
              simulateTyping(() => {
                searchEstabelecimento(message);
              }, 2500);
              return;
            }
            
            // Comandos
            if (messageLower === '/ajuda' || messageLower === 'ajuda') {
              simulateTyping(() => {
                addMessage(`<strong>üí° Comandos Dispon√≠veis:</strong><br>
‚Ä¢ Digite um <strong>c√≥digo EG</strong> para an√°lise completa<br>
‚Ä¢ <strong>/status</strong> para verificar status do sistema<br>
‚Ä¢ <strong>/dados</strong> para ver c√≥digos dispon√≠veis<br>
‚Ä¢ <strong>IA Conversacional:</strong> Converse naturalmente!<br><br>
<strong>üéØ Sistema DIRETA MG - An√°lise Autom√°tica:</strong><br>
‚Ä¢ An√°lise POSITIVA dos pontos fortes<br>
‚Ä¢ An√°lise NEGATIVA das oportunidades<br>
‚Ä¢ Recomenda√ß√µes estrat√©gicas<br>
‚Ä¢ Pr√≥ximos passos autom√°ticos<br><br>
<em>Sistema Raio-X Score 5 - Inspec√ß√£o inteligente!</em>`, 'bot');
              }, 1200);
              return;
            }
            
            if (messageLower === '/status' || messageLower === 'status') {
              simulateTyping(() => {
                if (csvData.length === 0) {
                  addMessage(`<strong>üìä Sistema Raio-X Score 5</strong><br>
‚Ä¢ Status: ‚ö†Ô∏è <strong>Carregando dados...</strong><br>
‚Ä¢ IA: ‚úÖ <strong>Ativada</strong><br>
‚Ä¢ Sistema: üöÄ <strong>Online</strong><br><br>
<em>Aguarde enquanto carregamos os dados.</em>`, 'bot');
                } else {
                  addMessage(`<strong>üìä Sistema Raio-X Score 5</strong><br>
‚Ä¢ Status: ‚úÖ <strong>Online e funcionando</strong><br>
‚Ä¢ Dados: ‚úÖ <strong>${csvData.length} estabelecimentos</strong><br>
‚Ä¢ IA: ‚úÖ <strong>An√°lise autom√°tica ativa</strong><br>
‚Ä¢ Interface: üöÄ <strong>Mobile-friendly</strong><br><br>
<em>DIRETA MG - Sistema operacional!</em>`, 'bot');
                }
              }, 1000);
              return;
            }

            if (messageLower === '/dados' || messageLower === 'dados') {
              if (csvData.length === 0) {
                simulateTyping(() => {
                  addMessage(`<strong>‚ùå Base de dados vazia</strong><br><br>
<em>Dados n√£o carregados.</em>`, 'bot');
                }, 800);
                return;
              }
              
              simulateTyping(() => {
                let codesList = `<strong>üìã C√≥digos EG Dispon√≠veis (${csvData.length}):</strong><br><br>`;
                csvData.forEach(est => {
                  codesList += `<strong>${est.eg}</strong> - ${est.nome_fantasia} (${est.rede})<br>`;
                });
                codesList += `<br><em>üí° Digite qualquer c√≥digo EG para an√°lise completa!</em>`;
                
                addMessage(codesList, 'bot');
              }, 800);
              return;
            }
            
            // Comando para configurar planilha
            if (messageLower.startsWith('/planilha ')) {
              const link = message.substring(10).trim();
              if (link) {
                simulateTyping(() => {
                  addMessage(`<strong>üîó Planilha Configurada</strong><br><br>
Processando os dados da planilha...<br><br>
‚úÖ <strong>Verifica√ß√µes:</strong><br>
‚Ä¢ Plano de dados p√∫blico<br>
‚Ä¢ Formato compat√≠vel<br>
‚Ä¢ Carregamento autom√°tico<br><br>
üîÑ <em>Atualizando sistema...</em>`, 'bot');
                  
                  // Tentar converter link e recarregar
                  setTimeout(() => {
                    try {
                      let csvUrl = link;
                      // Converter link de edit para export se necess√°rio
                      if (link.includes('/edit')) {
                        const idMatch = link.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
                        if (idMatch) {
                          csvUrl = `https://docs.google.com/spreadsheets/d/${idMatch[1]}/export?format=csv`;
                        }
                      } else if (!link.includes('/export?format=csv') && !link.includes('/pub?output=csv')) {
                        const idMatch = link.match(/\/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
                        if (idMatch) {
                          csvUrl = `https://docs.google.com/spreadsheets/d/${idMatch[1]}/pub?output=csv`;
                        }
                      }
                      
                      // Atualizar URL global
                      window.GOOGLE_SHEET_CSV_URL = csvUrl;
                      
                      // Recarregar dados
                      setIsSheetLoaded(false);
                      setTimeout(() => {
                        loadSheetData();
                      }, 1000);
                      
                    } catch (error) {
                      console.error('Erro ao processar link:', error);
                      addMessage(`<strong>‚ùå Erro ao processar link</strong><br>
Verifique se o formato est√° correto e tente novamente.`, 'bot');
                    }
                  }, 2000);
                  
                }, 1000);
                return;
              } else {
                simulateTyping(() => {
                  addMessage(`<strong>‚ùå Link n√£o fornecido</strong><br><br>
<b>Uso correto:</b><br>
<strong>/planilha [SEU_LINK_AQUI]</strong><br><br>
<b>Exemplo:</b><br>
<strong>/planilha https://docs.google.com/spreadsheets/d/1ABC123DEF456/edit#gid=0</strong>`, 'bot');
                }, 800);
                return;
              }
            }
            
            // IA conversacional
            let response = '';
            
            // Sauda√ß√µes
            if (messageLower.includes('oi') || messageLower.includes('ol√°') || messageLower.includes('hello')) {
              response = `ü§ñ **Bem-vindo ao Raio-X Score 5!**
              
Sou o assistente de IA da DIRETA MG, especializado em an√°lise de performance de estabelecimentos.

üí° **Como posso ajudar:**
‚Ä¢ Digite um c√≥digo EG para an√°lise profissional
‚Ä¢ Use /ajuda para ver comandos
‚Ä¢ /dados para ver c√≥digos dispon√≠veis

üéØ **Experimente:** Digite um c√≥digo EG para ver an√°lise completa!`;
            }
            else if (messageLower.includes('como') && (messageLower.includes('vai') || messageLower.includes('est√°'))) {
              response = `üòä **Sistema funcionando perfeitamente!**

‚ö° **Status DIRETA MG:**
‚Ä¢ ‚úÖ IA ativada e processando dados
‚Ä¢ ‚úÖ Base de ${csvData.length} estabelecimentos ativa
‚Ä¢ ‚úÖ An√°lises autom√°ticas funcionando
‚Ä¢ ‚úÖ ${csvData.length} c√≥digos EG dispon√≠veis

üéØ **Funcionalidades ativas:**
‚Ä¢ An√°lise autom√°tica de c√≥digos EG
‚Ä¢ Identifica√ß√£o de pontos positivos
‚Ä¢ Detec√ß√£o de oportunidades
‚Ä¢ Recomenda√ß√µes estrat√©gicas

üß† **Teste o sistema:** Digite "${csvData[0]?.eg || '67285-8'}" para ver a an√°lise em a√ß√£o!`;
            }
            else if (messageLower.includes('teste') || messageLower.includes('funciona')) {
              response = `‚úÖ **TESTE CONFIRMADO - Sistema 100% Operacional!**

üß™ **Verifica√ß√£o completa:**
‚Ä¢ ‚úÖ Interface carregada e responsiva
‚Ä¢ ‚úÖ Bot√£o "Iniciar Conversa" funcionando
‚Ä¢ ‚úÖ IA respondendo normalmente
‚Ä¢ ‚úÖ Base de ${csvData.length} estabelecimentos ativa
‚Ä¢ ‚úÖ An√°lises autom√°ticas operacionais
‚Ä¢ ‚úÖ Sistema DIRETA MG online

üéØ **Status:** TODOS OS SISTEMAS FUNCIONANDO NORMALMENTE

üöÄ **Demonstra√ß√£o:** Digite "${csvData[0]?.eg || '67285-8'}" para ver a an√°lise completa!`;
            }
            else if (messageLower.includes('an√°lise') || messageLower.includes('analise')) {
              response = `üìä **SISTEMA DE AN√ÅLISE DIRETA MG:**

ü§ñ **Como funciona:**
‚Ä¢ Recebe c√≥digo EG ‚Üí Busca dados ‚Üí Analisa automaticamente
‚Ä¢ Mostra **PONTOS POSITIVOS** (pontos fortes)
‚Ä¢ Mostra **PONTOS NEGATIVOS** (oportunidades de melhoria)
‚Ä¢ Fornece **RECOMENDA√á√ïES** estrat√©gicos
‚Ä¢ Sugere **PR√ìXIMOS PASSOS** inteligentes

‚úÖ **O que a IA analisa:**
‚Ä¢ Performance M0 vs M-1 (crescimento/queda)
‚Ä¢ Indicadores de g√¥ndola e ponto extra
‚Ä¢ Atendimento especial e evolu√ß√£o
‚Ä¢ Coordenadores e supervisionamento

üí° **Teste na pr√°tica:** Digite qualquer c√≥digo EG e veja a an√°lise!

üéØ **C√≥digos para testar:** ${csvData.slice(0, 3).map(est => est.eg).join(', ')}`;
            }
            else if (messageLower.includes('diretamg') || messageLower.includes('sobre')) {
              response = `üè¢ **DIRETA MG - RAIO-X SCORE 5**

üéØ **Especializa√ß√£o:**
‚Ä¢ An√°lise de performance de estabelecimentos
‚Ä¢ Interpreta√ß√£o avan√ßada de m√©tricas (GN, SL/SC, M0, etc.)
‚Ä¢ ${csvData.length} c√≥digos EG processados automaticamente
‚Ä¢ IA analisa POSITIVOS e NEGATIVOS em tempo real

üöÄ **Caracter√≠sticas principais:**
‚Ä¢ ü§ñ IA conversacional avan√ßada
‚Ä¢ üìä An√°lises autom√°ticas instant√¢neas
‚Ä¢ üì± Interface mobile-first responsiva
‚Ä¢ üéØ Sistema focado em performance`;

            }
            else {
              response = `ü§ñ **Rob√¥ DIRETA MG Respondeu!**

Entendi sua mensagem: "${message}"

üß† **IA DIRETA MG processando:**
Compreendo e estou aqui para ajudar com an√°lises completas de estabelecimentos!

üí° **Como posso ajudar especificamente:**
‚Ä¢ **${csvData.length} c√≥digos EG dispon√≠veis** ‚Üí Dados completos + an√°lise IA (positivos + negativos)
‚Ä¢ **/ajuda** ‚Üí Ver todos os comandos
‚Ä¢ **/dados** ‚Üí Ver c√≥digos EG dispon√≠veis
‚Ä¢ **/status** ‚Üí Verificar sistema

üéØ **Funcionalidade principal:** Digite qualquer c√≥digo EG e a IA far√° an√°lise autom√°tica!

üöÄ **C√≥digos para testar:** ${csvData.slice(0, 2).map(est => est.eg).join(', ')}

üí° **DIRETA MG - Sempre funcionando com an√°lise inteligente!**`;
            }
            
            simulateTyping(() => {
              addMessage(response.replace(/\n/g, '<br>'), 'bot');
            }, 2000);
          };

          // Buscar estabelecimento
          const searchEstabelecimento = (code) => {
            const data = findEstabelecimento(code);
            
            if (data) {
              // Dados b√°sicos primeiro
              addMessage(`<strong>‚úÖ C√≥digo ${code} encontrado!</strong><br><br>
<strong>üìä DADOS DO ESTABELECIMENTO:</strong><br>
‚Ä¢ <strong>EG:</strong> ${data.eg}<br>
‚Ä¢ <strong>Nome:</strong> ${data.nome_fantasia}<br>
‚Ä¢ <strong>Rede:</strong> ${data.rede}<br>
‚Ä¢ <strong>Coordenador:</strong> ${data.coordenador}<br>
‚Ä¢ <strong>Supervisor:</strong> ${data.supervisor_terceiro}<br>
‚Ä¢ <strong>GN:</strong> ${data.gn}<br>
‚Ä¢ <strong>SL/SC:</strong> ${data.sl_sc}<br>
‚Ä¢ <strong>AE:</strong> ${data.ae}<br>
‚Ä¢ <strong>M-1:</strong> ${data.m1}<br>
‚Ä¢ <strong>M0:</strong> ${data.m0}<br>
‚Ä¢ <strong>vs M-1:</strong> ${data.vs_m1}<br>
‚Ä¢ <strong>G√¥ndola:</strong> ${data.gondola}<br>
‚Ä¢ <strong>Ponto Extra:</strong> ${data.ponto_extra}<br>
‚Ä¢ <strong>Base Foco:</strong> ${data.base_foco}<br>
‚Ä¢ <strong>Corona:</strong> ${data.corona}<br>
‚Ä¢ <strong>Spaten:</strong> ${data.spaten}<br>
‚Ä¢ <strong>Stella:</strong> ${data.stella}<br>
‚Ä¢ <strong>COB HDW:</strong> ${data.cob_hdw}<br>
‚Ä¢ <strong>Atendimento:</strong> ${data.atendimento}<br>
‚Ä¢ <strong>Visita:</strong> ${data.visita_quinzenal}<br>
‚Ä¢ <strong>Loja:</strong> ${data.loja}<br><br>
<em>üöÄ Agora vou fazer an√°lise IA completa (positivos + negativos + recomenda√ß√µes)...</em>`, 'bot');
              
              // An√°lise ap√≥s mostrar dados usando Google AI
              setTimeout(async () => {
                try {
                  addMessage('ü§ñ **Processando an√°lise com Google AI Gemini...**', 'bot');
                  const analysis = await analyzeWithGeminiAI(data, code);
                  addMessage(analysis, 'bot');
                } catch (error) {
                  console.error('Erro na an√°lise IA:', error);
                  const fallbackAnalysis = getIntelligentAnalysis(data, code);
                  addMessage(fallbackAnalysis, 'bot');
                }
              }, 1500);
              
            } else {
              addMessage(`<strong>‚ùå C√≥digo ${code} n√£o encontrado</strong><br><br>
‚Ä¢ Verifique se o c√≥digo est√° correto<br>
‚Ä¢ Use <strong>/dados</strong> para ver c√≥digos dispon√≠veis<br>
‚Ä¢ Base de dados: <strong>${csvData.length} estabelecimentos carregados</strong><br><br>
<strong>üéØ C√≥digos EG dispon√≠veis:</strong><br>
${csvData.slice(0, 3).map(est => `‚Ä¢ ${est.eg} - ${est.nome_fantasia}`).join('<br>')}<br><br>
<em>DIRETA MG - Sistema de consultas inteligente</em>`, 'bot');
            }
          };

          // Iniciar chat
          const startChat = () => {
            setIsWelcomeScreen(false);
            setTimeout(() => {
              addMessage(`<strong>‚ö†Ô∏è ATEN√á√ÉO: CONFIGURA√á√ÉO NECESS√ÅRIA!</strong><br><br>
Ol√°! Sou o <strong>Assistente de IA da DIRETA MG</strong>, especialista em an√°lise de performance de estabelecimentos.<br><br>

<b>üîó PARA FUNCIONAR, PRECISO DO LINK DA SUA PLANILHA:</b><br>
1. Acesse sua planilha Google Sheets<br>
2. Clique em "Compartilhar" ‚Üí "Copiar link"<br>
3. O link deve ficar assim:<br>
   <code>https://docs.google.com/spreadsheets/d/ID_AQUI/edit</code><br><br>

<b>ü§ñ SISTEMA:</b><br>
‚Ä¢ IA Google Gemini: ‚úÖ <strong>Ativada</strong> (chave atualizada)<br>
‚Ä¢ Base de dados: ‚ö†Ô∏è <strong>Aguardando link da planilha</strong><br>
‚Ä¢ Interface: ‚úÖ <strong>Funcionando perfeitamente</strong><br><br>

<b>üõ†Ô∏è COMANDOS DISPON√çVEIS:</b><br>
‚Ä¢ Digite um <strong>c√≥digo EG</strong> quando a planilha estiver configurada<br>
‚Ä¢ Use <strong>/ajuda</strong> para ver todos os comandos<br>
‚Ä¢ <strong>/dados</strong> para ver c√≥digos dispon√≠veis (quando planilha carregada)<br>
‚Ä¢ <strong>/status</strong> para verificar configura√ß√£o<br><br>

<b>üìù Exemplos de c√≥digos EG:</b><br>
67285-8, 75668-7, 105270-5<br><br>

<strong>Como posso ajud√°-lo?</strong>`, 'bot');
            }, 500);
            
            // Carregar dados em background
            setTimeout(() => {
              loadSheetData();
            }, 1000);
          };

          // Enviar mensagem - VERS√ÉO MELHORADA
          const handleSubmit = async (e) => {
            e.preventDefault();
            const message = inputValue.trim();
            
            if (!message) {
              return; // N√£o fazer nada se n√£o h√° mensagem
            }
            
            // Feedback visual imediato
            setIsLoading(true);
            
            try {
              addMessage(`<strong>üë§ Voc√™:</strong> ${message}`, 'user');
              await processMessage(message);
              setInputValue('');
            } catch (error) {
              console.error('Erro ao processar mensagem:', error);
              addMessage('<strong>‚ùå Erro:</strong> N√£o foi poss√≠vel processar sua mensagem. Tente novamente.', 'bot');
            } finally {
              setIsLoading(false);
            }
          };

          // Enter no input - MELHORADO
          const handleKeyPress = (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              const message = inputValue.trim();
              if (message) {
                handleSubmit(e);
              }
            }
          };

          // Toggle tema
          const toggleTheme = () => {
            const themes = ['light', 'dark', 'professional'];
            const currentIndex = themes.indexOf(currentTheme);
            const nextIndex = (currentIndex + 1) % themes.length;
            setCurrentTheme(themes[nextIndex]);
          };

          // Sistema de Part√≠culas
          const initializeParticleSystem = () => {
            const canvas = document.getElementById('particles-canvas');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            if (!ctx) return;

            let particles = [];
            const mouse = { x: 0, y: 0 };
            
            const getThemeColors = () => {
              if (currentTheme === 'light') {
                return [
                  'rgba(59, 130, 246, 0.6)',
                  'rgba(16, 185, 129, 0.4)',
                  'rgba(245, 158, 11, 0.5)',
                  'rgba(107, 114, 128, 0.3)'
                ];
              } else if (currentTheme === 'dark') {
                return [
                  'rgba(96, 165, 250, 0.7)',
                  'rgba(251, 191, 36, 0.6)',
                  'rgba(34, 197, 94, 0.5)',
                  'rgba(148, 163, 184, 0.4)'
                ];
              } else {
                return [
                  'rgba(30, 64, 175, 0.6)',
                  'rgba(245, 158, 11, 0.5)',
                  'rgba(100, 116, 139, 0.4)',
                  'rgba(16, 185, 129, 0.3)'
                ];
              }
            };

            const resize = () => {
              canvas.width = window.innerWidth;
              canvas.height = window.innerHeight;
            };

            const createParticles = () => {
              const particleCount = Math.min(30, Math.floor((window.innerWidth * window.innerHeight) / 20000));
              const colors = getThemeColors();
              
              particles = [];
              for (let i = 0; i < particleCount; i++) {
                particles.push({
                  x: Math.random() * canvas.width,
                  y: Math.random() * canvas.height,
                  size: Math.random() * 3 + 1,
                  speedX: (Math.random() - 0.5) * 2,
                  speedY: (Math.random() - 0.5) * 2,
                  color: colors[Math.floor(Math.random() * colors.length)],
                  opacity: Math.random() * 0.5 + 0.2,
                  pulse: 1
                });
              }
            };

            const updateParticles = () => {
              particles.forEach(particle => {
                // Movimento suave com efeito magn√©tico
                const dx = mouse.x - particle.x;
                const dy = mouse.y - particle.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 80) {
                  const force = (80 - distance) / 80;
                  particle.speedX += (dx / distance) * force * 0.01;
                  particle.speedY += (dy / distance) * force * 0.01;
                }
                
                // Aplicar fric√ß√£o
                particle.speedX *= 0.99;
                particle.speedY *= 0.99;
                
                particle.x += particle.speedX;
                particle.y += particle.speedY;
                
                // Rebater nas bordas
                if (particle.x < 0 || particle.x > canvas.width) {
                  particle.speedX *= -0.8;
                  particle.x = Math.max(0, Math.min(canvas.width, particle.x));
                }
                if (particle.y < 0 || particle.y > canvas.height) {
                  particle.speedY *= -0.8;
                  particle.y = Math.max(0, Math.min(canvas.height, particle.y));
                }
                
                // Pulsa√ß√£o suave
                particle.pulse = Math.sin(Date.now() * 0.003 + particle.x * 0.01) * 0.3 + 0.7;
              });
            };

            const drawParticles = () => {
              ctx.clearRect(0, 0, canvas.width, canvas.height);
              
              particles.forEach(particle => {
                ctx.save();
                
                // Efeito de brilho sutil
                ctx.shadowBlur = 10;
                ctx.shadowColor = particle.color;
                
                // Desenhar part√≠cula
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size * particle.pulse, 0, Math.PI * 2);
                ctx.fillStyle = particle.color;
                ctx.globalAlpha = particle.opacity;
                ctx.fill();
                
                // Linhas conectivas para part√≠culas pr√≥ximas
                particles.forEach((otherParticle, otherIndex) => {
                  const dx = particle.x - otherParticle.x;
                  const dy = particle.y - otherParticle.y;
                  const distance = Math.sqrt(dx * dx + dy * dy);
                  
                  if (distance < 60 && particle !== otherParticle) {
                    ctx.beginPath();
                    ctx.moveTo(particle.x, particle.y);
                    ctx.lineTo(otherParticle.x, otherParticle.y);
                    ctx.strokeStyle = `rgba(255, 255, 255, ${0.1 * (1 - distance / 60)})`;
                    ctx.lineWidth = 0.5;
                    ctx.globalAlpha = 0.3;
                    ctx.stroke();
                  }
                });
                
                ctx.restore();
              });
            };

            const animate = () => {
              updateParticles();
              drawParticles();
              requestAnimationFrame(animate);
            };

            // Event listeners
            const handleMouseMove = (e) => {
              mouse.x = e.clientX;
              mouse.y = e.clientY;
            };

            const handleResize = () => {
              resize();
              createParticles();
            };

            // Inicializar
            resize();
            createParticles();
            animate();

            // Event listeners
            window.addEventListener('mousemove', handleMouseMove);
            window.addEventListener('resize', handleResize);

            // Cleanup
            return () => {
              window.removeEventListener('mousemove', handleMouseMove);
              window.removeEventListener('resize', handleResize);
            };
          };

          // Inicializar sistemas modernos
          React.useEffect(() => {
            // Aguardar componente montado
            const initTimer = setTimeout(() => {
              initializeParticleSystem();
              console.log('üöÄ Sistema Profissional Ativado!');
            }, 100);

            return () => {
              clearTimeout(initTimer);
            };
          }, []);

          // Recriar part√≠culas quando tema mudar
          React.useEffect(() => {
            const canvas = document.getElementById('particles-canvas');
            if (canvas) {
              // Pequeno delay para permitir transi√ß√£o suave do CSS
              setTimeout(() => {
                initializeParticleSystem();
              }, 300);
            }
          }, [currentTheme]);

          // √çcones SVG - ROB√î PROFISSIONAL
          const BotIcon = () => React.createElement('svg', {
            width: '24', height: '24', viewBox: '0 0 24 24', fill: 'currentColor', strokeWidth: '0', viewBox: '0 0 24 24'
          }, [
            React.createElement('path', { 
              key: 1, 
              d: "M8 2v2a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V2a3 3 0 0 0-3 3v11a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V5a3 3 0 0 0-3-3zm4 4h2a1 1 0 1 1 0 2H10a1 1 0 1 1 0-2zm4 0h2a1 1 0 1 1 0 2H14a1 1 0 1 1 0-2zM6 6h12a1 1 0 1 1 0 2H6a1 1 0 1 1 0-2zm0 3h12a1 1 0 1 1 0 2H6a1 1 0 1 1 0-2z"
            })
          ]);
          
          // √çcone de rob√¥ grande para o logo
          const LargeBotIcon = () => React.createElement('svg', {
            width: '80', height: '80', viewBox: '0 0 80 80', xmlns: 'http://www.w3.org/2000/svg'
          }, [
            // Cabe√ßa do rob√¥
            React.createElement('rect', { 
              key: 1, 
              x: '15', y: '8', width: '50', height: '32', rx: '8', 
              fill: '#3b82f6', stroke: '#ffffff', strokeWidth: '2'
            }),
            // Antena
            React.createElement('line', { 
              key: 2, 
              x1: '40', y1: '8', x2: '40', y2: '3', 
              stroke: '#ffffff', strokeWidth: '2'
            }),
            React.createElement('circle', { 
              key: 3, 
              cx: '40', cy: '2', r: '2', 
              fill: '#ffffff'
            }),
            // Olhos
            React.createElement('circle', { 
              key: 4, 
              cx: '25', cy: '22', r: '4', 
              fill: '#ffffff'
            }),
            React.createElement('circle', { 
              key: 5, 
              cx: '55', cy: '22', r: '4', 
              fill: '#ffffff'
            }),
            React.createElement('circle', { 
              key: 6, 
              cx: '25', cy: '22', r: '2', 
              fill: '#3b82f6'
            }),
            React.createElement('circle', { 
              key: 7, 
              cx: '55', cy: '22', r: '2', 
              fill: '#3b82f6'
            }),
            // Boca
            React.createElement('rect', { 
              key: 8, 
              x: '28', y: '28', width: '24', height: '4', rx: '2', 
              fill: '#ffffff'
            }),
            // Corpo do rob√¥
            React.createElement('rect', { 
              key: 9, 
              x: '18', y: '42', width: '44', height: '25', rx: '5', 
              fill: '#3b82f6', stroke: '#ffffff', strokeWidth: '2'
            }),
            // Painel de controle no peito
            React.createElement('rect', { 
              key: 10, 
              x: '30', y: '47', width: '20', height: '15', rx: '3', 
              fill: '#ffffff'
            }),
            React.createElement('circle', { 
              key: 11, 
              cx: '33', cy: '52', r: '2', 
              fill: '#3b82f6'
            }),
            React.createElement('rect', { 
              key: 12, 
              x: '37', y: '51', width: '10', height: '2', rx: '1', 
              fill: '#3b82f6'
            }),
            // Bra√ßos
            React.createElement('rect', { 
              key: 13, 
              x: '8', y: '45', width: '8', height: '6', rx: '2', 
              fill: '#3b82f6', stroke: '#ffffff', strokeWidth: '2'
            }),
            React.createElement('rect', { 
              key: 14, 
              x: '64', y: '45', width: '8', height: '6', rx: '2', 
              fill: '#3b82f6', stroke: '#ffffff', strokeWidth: '2'
            }),
            // Pernas
            React.createElement('rect', { 
              key: 15, 
              x: '25', y: '67', width: '8', height: '8', rx: '2', 
              fill: '#3b82f6', stroke: '#ffffff', strokeWidth: '2'
            }),
            React.createElement('rect', { 
              key: 16, 
              x: '47', y: '67', width: '8', height: '8', rx: '2', 
              fill: '#3b82f6', stroke: '#ffffff', strokeWidth: '2'
            })
          ]);

          const SendIcon = () => React.createElement('svg', {
            width: '18', height: '18', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2', strokeLinecap: 'round', strokeLinejoin: 'round'
          }, [
            React.createElement('path', { key: 1, d: 'm22 2-7 20-4-9-9-4z' }),
            React.createElement('path', { key: 2, d: 'M22 2 11 13' })
          ]);

          const BarChartIcon = () => React.createElement('svg', {
            width: '20', height: '20', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2', strokeLinecap: 'round', strokeLinejoin: 'round'
          }, [
            React.createElement('line', { key: 1, x1: '12', y1: '20', x2: '12', y2: '10' }),
            React.createElement('line', { key: 2, x1: '18', y1: '20', x2: '18', y2: '4' }),
            React.createElement('line', { key: 3, x1: '6', y1: '20', x2: '6', y2: '16' })
          ]);

          const SunIcon = () => React.createElement('svg', {
            width: '20', height: '20', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2', strokeLinecap: 'round', strokeLinejoin: 'round'
          }, [
            React.createElement('circle', { key: 1, cx: '12', cy: '12', r: '5' }),
            React.createElement('path', { key: 2, d: 'M12 1v2' }),
            React.createElement('path', { key: 3, d: 'M12 21v2' }),
            React.createElement('path', { key: 4, d: 'M4.22 4.22l1.42 1.42' }),
            React.createElement('path', { key: 5, d: 'M18.36 18.36l1.42 1.42' }),
            React.createElement('path', { key: 6, d: 'M1 12h2' }),
            React.createElement('path', { key: 7, d: 'M21 12h2' }),
            React.createElement('path', { key: 8, d: 'M4.22 19.78l1.42-1.42' }),
            React.createElement('path', { key: 9, d: 'M18.36 5.64l1.42-1.42' })
          ]);

          const MoonIcon = () => React.createElement('svg', {
            width: '20', height: '20', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2', strokeLinecap: 'round', strokeLinejoin: 'round'
          }, [
            React.createElement('path', { key: 1, d: 'M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z' })
          ]);

          const ZapIcon = () => React.createElement('svg', {
            width: '20', height: '20', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2', strokeLinecap: 'round', strokeLinejoin: 'round'
          }, [
            React.createElement('polygon', { key: 1, points: '13 2 3 14 12 14 11 22 21 10 12 10 13 2' })
          ]);

          const XIcon = () => React.createElement('svg', {
            width: '20', height: '20', viewBox: '0 0 24 24', fill: 'none', stroke: 'currentColor', strokeWidth: '2', strokeLinecap: 'round', strokeLinejoin: 'round'
          }, [
            React.createElement('line', { key: 1, x1: '18', y1: '6', x2: '6', y2: '18' }),
            React.createElement('line', { key: 2, x1: '6', y1: '6', x2: '18', y2: '18' })
          ]);

          return React.createElement('div', { className: `app ${currentTheme}` }, [
            // Canvas de Part√≠culas
            React.createElement('canvas', {
              key: 'particles',
              id: 'particles-canvas',
              className: 'particles-canvas',
              style: {
                position: 'fixed',
                top: 0,
                left: 0,
                width: '100%',
                height: '100%',
                zIndex: -1,
                pointerEvents: 'none'
              }
            }),
            
            // Bot√£o de Tema
            React.createElement('button', {
              key: 'theme-toggle',
              onClick: toggleTheme,
              className: 'theme-toggle',
              title: `Tema atual: ${currentTheme}`
            }, [
              currentTheme === 'light' && React.createElement(SunIcon, { key: 'sun' }),
              currentTheme === 'dark' && React.createElement(MoonIcon, { key: 'moon' }),
              currentTheme === 'professional' && React.createElement(BarChartIcon, { key: 'chart' })
            ]),

            // Tela de Boas-vindas
            isWelcomeScreen && React.createElement('div', {
              key: 'welcome',
              className: 'welcome-screen'
            }, [
              React.createElement('div', {
                key: 'bg-pattern',
                className: 'welcome-bg-pattern'
              }),
              React.createElement('div', {
                key: 'content',
                className: 'welcome-content'
              }, [
                React.createElement('h1', {
                  key: 'title',
                  className: 'welcome-title animate-fade-in-up'
                }, 'Raio-X Score 5'),
                
                React.createElement('div', {
                  key: 'subtitle-container',
                  className: 'subtitle-container'
                }, [
                  React.createElement('p', {
                    key: 'subtitle',
                    className: 'welcome-subtitle animate-fade-in-up'
                  }, subtitles[subtitleIndex])
                ]),

                React.createElement('div', {
                  key: 'robot-container',
                  className: 'robot-container'
                }, [
                  React.createElement('div', {
                    key: 'robot-image',
                    className: 'robot-image animate-bounce-gentle',
                    style: {
                      background: 'linear-gradient(135deg, #1e40af, #3b82f6)',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center'
                    }
                  }, [
                    React.createElement(LargeBotIcon, { 
                      key: 'robot-icon-large', 
                      className: 'robot-icon',
                      style: {
                        color: 'white',
                        filter: 'drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1))'
                      }
                    })
                  ])
                ]),

                React.createElement('p', {
                  key: 'company-info',
                  className: 'company-info animate-fade-in-up'
                }, 'Desenvolvido pela ', React.createElement('span', {
                  key: 'company-name',
                  className: 'company-name'
                }, 'DIRETA MG')),

                React.createElement('button', {
                  key: 'start-button',
                  onClick: startChat,
                  className: 'start-button animate-fade-in-up'
                }, [
                  React.createElement(ZapIcon, { key: 'zap-icon' }),
                  'Iniciar Conversa'
                ])
              ])
            ]),

            // Chat Container
            !isWelcomeScreen && React.createElement('div', {
              key: 'chat',
              className: 'chat-container'
            }, [
              React.createElement('div', {
                key: 'phone-frame',
                className: 'phone-frame'
              }, [
                // Header
                React.createElement('div', {
                  key: 'chat-header',
                  className: 'chat-header'
                }, [
                  React.createElement('div', {
                    key: 'header-info',
                    className: 'header-info'
                  }, [
                    React.createElement('div', {
                      key: 'header-avatar',
                      className: 'header-avatar'
                    }, [
                      React.createElement(BotIcon, { key: 'header-bot' })
                    ]),
                    React.createElement('div', {
                      key: 'header-text',
                      className: 'header-text'
                    }, [
                      React.createElement('h1', {
                        key: 'header-title',
                        className: 'header-title'
                      }, 'Raio-X Score 5'),
                      React.createElement('p', {
                        key: 'header-subtitle',
                        className: 'header-subtitle'
                      }, isSheetLoaded ? `${csvData.length} estabelecimentos carregados` : 'Carregando dados...')
                    ])
                  ]),
                  React.createElement('button', {
                    key: 'close-button',
                    onClick: () => setIsWelcomeScreen(true),
                    className: 'close-button',
                    title: 'Fechar chat'
                  }, [
                    React.createElement(XIcon, { key: 'close-x' })
                  ])
                ]),

                // Messages
                React.createElement('div', {
                  key: 'messages-container',
                  className: 'messages-container'
                }, [
                  // Renderizar mensagens
                  ...messages.map((message, index) => 
                    React.createElement('div', {
                      key: `message-${index}`,
                      className: `message ${message.sender} animate-message-slide`,
                      dangerouslySetInnerHTML: { __html: message.content }
                    })
                  ),
                  
                  // Typing Indicator
                  isTyping && React.createElement('div', {
                    key: 'typing-indicator',
                    className: 'typing-indicator'
                  }, [
                    React.createElement('div', {
                      key: 'typing-dots',
                      className: 'typing-dots'
                    }, [
                      React.createElement('span', { key: 'dot-1', className: 'typing-dot' }),
                      React.createElement('span', { key: 'dot-2', className: 'typing-dot' }),
                      React.createElement('span', { key: 'dot-3', className: 'typing-dot' })
                    ]),
                    'IA est√° digitando...'
                  ]),
                  
                  // Ref para scroll
                  React.createElement('div', {
                    key: 'messages-end',
                    ref: messagesEndRef
                  })
                ]),

                // Input
                React.createElement('div', {
                  key: 'input-container',
                  className: 'input-container'
                }, [
                  React.createElement('form', {
                    key: 'chat-form',
                    onSubmit: handleSubmit,
                    className: 'chat-form'
                  }, [
                    React.createElement('input', {
                      key: 'message-input',
                      ref: inputRef,
                      value: inputValue,
                      onChange: (e) => setInputValue(e.target.value),
                      onKeyDown: handleKeyPress,
                      type: 'text',
                      placeholder: 'Digite um c√≥digo EG ou comando...',
                      className: 'message-input',
                      autoComplete: 'off'
                    }),
                    React.createElement('button', {
                      key: 'send-button',
                      type: 'submit',
                      className: 'send-button',
                      disabled: isLoading
                    }, [
                      React.createElement(SendIcon, { key: 'send-icon' })
                    ])
                  ])
                ])
              ])
            ])
          ]);
        }

        // Inicializar vari√°vel global para URL da planilha
        window.GOOGLE_SHEET_CSV_URL = null;

        // Renderizar o app
        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
